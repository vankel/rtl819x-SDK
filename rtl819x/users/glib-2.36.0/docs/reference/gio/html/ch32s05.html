<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Generating code and docs</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.77.1">
<link rel="home" href="index.html" title="GIO Reference Manual">
<link rel="up" href="ch32.html" title="Migrating to GDBus">
<link rel="prev" href="ch32s04.html" title="Creating proxies for well-known names">
<link rel="next" href="gdbus-org.gtk.GDBus.Example.ObjectManager.Animal.html" title="org.gtk.GDBus.Example.ObjectManager.Animal">
<meta name="generator" content="GTK-Doc V1.18.1 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="2"><tr valign="middle">
<td><a accesskey="p" href="ch32s04.html"><img src="left.png" width="24" height="24" border="0" alt="Prev"></a></td>
<td><a accesskey="u" href="ch32.html"><img src="up.png" width="24" height="24" border="0" alt="Up"></a></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="24" height="24" border="0" alt="Home"></a></td>
<th width="100%" align="center">GIO Reference Manual</th>
<td><a accesskey="n" href="gdbus-org.gtk.GDBus.Example.ObjectManager.Animal.html"><img src="right.png" width="24" height="24" border="0" alt="Next"></a></td>
</tr></table>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="id-1.5.5.6"></a>Generating code and docs</h2></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="gdbus-example-gdbus-codegen"></a>Using gdbus-codegen</h3></div></div></div>
<p>
      dbus-glib comes with <span class="command"><strong>dbus-binding-tool</strong></span>, which
      can produce somewhat nice client- and server-side wrappers for a D-Bus interface.
      With GDBus, <span class="command"><strong><a href="gdbus-codegen.html">gdbus-codegen</a></strong></span> is used and like
      its counterpart, it also takes D-Bus Introspection XML as input:
    </p>
<div class="example">
<a name="gdbus-example-codegen-input"></a><p class="title"><b>Example 29. Example D-Bus Introspection XML</b></p>
<div class="example-contents">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre></td>
        <td class="listing_code"><pre class="programlisting">&lt;node&gt;
  &lt;!-- org.gtk.GDBus.Example.ObjectManager.Animal:
       @short_description: Example docs generated by gdbus-codegen
       @since: <span class="number">2.30</span>

       This D-Bus interface is used to describe a simple animal.
    --&gt;
  &lt;interface name=<span class="number">&quot;org.gtk.GDBus.Example.ObjectManager.Animal&quot;</span>&gt;
    &lt;!-- Mood: The mood of the animal.
         @since: <span class="number">2.30</span>

         Known values <span class="keyword">for</span> <span class="keyword">this</span> property include
         &lt;literal&gt;Happy&lt;/literal&gt; <span class="keyword">and</span> &lt;literal&gt;Sad&lt;/literal&gt;. Use the
         org.gtk.GDBus.Example.ObjectManager.Animal.Poke() method to
         change <span class="keyword">this</span> property.

         This property influences how often the animal jumps up <span class="keyword">and</span>
         down, see the
         #org.gtk.GDBus.Example.ObjectManager.Animal::Jumped signal
         <span class="keyword">for</span> more details.
    --&gt;
    &lt;property name=<span class="number">&quot;Mood&quot;</span> type=<span class="number">&quot;s&quot;</span> access=<span class="number">&quot;read&quot;</span>/&gt;

    &lt;!--
        <span class="keyword">Poke</span>:
        @make_sad: Whether to make the animal sad.
        @make_happy: Whether to make the animal happy.
        @since: <span class="number">2.30</span>

        Method used to changing the mood of the animal. See also the
        #org.gtk.GDBus.Example.ObjectManager.Animal:Mood property.
      --&gt;
    &lt;method name=<span class="number">&quot;Poke&quot;</span>&gt;
      &lt;arg direction=<span class="number">&quot;in&quot;</span> type=<span class="number">&quot;b&quot;</span> name=<span class="number">&quot;make_sad&quot;</span>/&gt;
      &lt;arg direction=<span class="number">&quot;in&quot;</span> type=<span class="number">&quot;b&quot;</span> name=<span class="number">&quot;make_happy&quot;</span>/&gt;
    &lt;/method&gt;

    &lt;!--
        <span class="keyword">Jumped</span>:
        @height: Height, in meters, that the animal jumped.
        @since: <span class="number">2.30</span>

        Emitted when the animal decides to jump.
      --&gt;
    &lt;signal name=<span class="number">&quot;Jumped&quot;</span>&gt;
      &lt;arg type=<span class="number">&quot;d&quot;</span> name=<span class="number">&quot;height&quot;</span>/&gt;
    &lt;/signal&gt;

    &lt;!--
        <span class="keyword">Foo</span>:
        Property with no &lt;quote&gt;since&lt;/quote&gt; annotation (should inherit the <span class="number">2.30</span> from its containing interface).
      --&gt;
    &lt;property name=<span class="number">&quot;Foo&quot;</span> type=<span class="number">&quot;s&quot;</span> access=<span class="number">&quot;read&quot;</span>/&gt;

    &lt;!--
        <span class="keyword">Bar</span>:
        @since: <span class="number">2.36</span>
        Property with a later &lt;quote&gt;since&lt;/quote&gt; annotation.
      --&gt;
    &lt;property name=<span class="number">&quot;Bar&quot;</span> type=<span class="number">&quot;s&quot;</span> access=<span class="number">&quot;read&quot;</span>/&gt;
  &lt;/interface&gt;

  &lt;!-- org.gtk.GDBus.Example.ObjectManager.Cat:
       @short_description: More example docs generated by gdbus-codegen

       This D-Bus interface is used to describe a cat. Right now there
       are no properties, methods <span class="keyword">or</span> signals associated with <span class="keyword">this</span>
       interface so it is essentially a &lt;ulink
       url=<span class="number">&quot;<a href="http://en.wikipedia.org/wiki/Marker_interface_pattern">http://en.wikipedia.org/wiki/Marker_interface_pattern</a>&quot;</span>&gt;Marker
       Interface&lt;/ulink&gt;.

       Note that D-Bus objects implementing <span class="keyword">this</span> interface also
       implement the #org.gtk.GDBus.Example.ObjectManager.Animal
       interface.
    --&gt;
  &lt;interface name=<span class="number">&quot;org.gtk.GDBus.Example.ObjectManager.Cat&quot;</span>&gt;
  &lt;/interface&gt;
&lt;/node&gt;</pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<br class="example-break"><p>
      If this XML is processed like this
</p>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6</pre></td>
        <td class="listing_code"><pre class="programlisting">gdbus-codegen --interface-prefix org.gtk.GDBus.Example.ObjectManager. \
              --generate-c-code generated-code                        \
              --c-<span class="type">namespace</span> Example                                   \
              --c-generate-object-manager                             \
              --generate-docbook generated-docs                       \
              gdbus-example-objectmanager.xml</pre></td>
      </tr>
    </tbody>
  </table>
</div>

<p>
      then two files <code class="filename">generated-code.h</code> and
      <code class="filename">generated-code.c</code> are
      generated. Additionally, two XML files
      <code class="filename">generated-docs-org.gtk.GDBus.Example.ObjectManager.Animal</code> and
      <code class="filename">generated-docs-org.gtk.GDBus.Example.ObjectManager.Cat</code>
      with Docbook XML are generated. For an example of what the docs look
      like see <a class="link" href="gdbus-org.gtk.GDBus.Example.ObjectManager.Animal.html#gdbus-interface-org-gtk-GDBus-Example-ObjectManager-Animal" title="Description">the Animal D-Bus interface documentation</a>.
      and
      <a class="link" href="gdbus-org.gtk.GDBus.Example.ObjectManager.Cat.html#gdbus-interface-org-gtk-GDBus-Example-ObjectManager-Cat" title="Description">the Cat D-Bus interface documentation</a>.
    </p>
<p>
      While the contents of <code class="filename">generated-code.h</code> and
      <code class="filename">generated-code.c</code> are best described by the
      <span class="command"><strong><a href="gdbus-codegen.html">gdbus-codegen</a></strong></span> manual
      page, brief examples of how this generated code can be used can be found in
      <a class="xref" href="ch32s05.html#gdbus-example-codegen-server" title="Example 30. Server-side application using generated code">Example 30, “Server-side application using generated code”</a>
      and <a class="xref" href="ch32s05.html#gdbus-example-codegen-client" title="Example 31. Client-side application using generated code">Example 31, “Client-side application using generated code”</a>. Additionally, since
      the generated code has 100% gtk-doc coverage, see
      <a class="link" href="ExampleAnimal.html" title="ExampleAnimal"><span class="type">ExampleAnimal</span></a>, <a class="link" href="ExampleCat.html" title="ExampleCat"><span class="type">ExampleCat</span></a>, <a class="link" href="ExampleObject.html" title="ExampleObject"><span class="type">ExampleObject</span></a> and
      <a class="link" href="ExampleObjectManagerClient.html" title="ExampleObjectManagerClient"><span class="type">ExampleObjectManagerClient</span></a> pages for documentation.
    </p>
<div class="example">
<a name="gdbus-example-codegen-server"></a><p class="title"><b>Example 30. Server-side application using generated code</b></p>
<div class="example-contents">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="preproc">#include </span><span class="number">&quot;gdbus-example-objectmanager-generated.h&quot;</span>

<span class="comment">/*</span><span class="comment"> ---------------------------------------------------------------------------------------------------- </span><span class="comment">*/</span>

<span class="type">static</span> GDBusObjectManagerServer *manager = <span class="number">NULL</span>;

<span class="type">static</span> <span class="type">gboolean</span>
on_animal_poke (ExampleAnimal          *animal,
                <span class="type">GDBusMethodInvocation</span>  *invocation,
                <span class="type">gboolean</span>                make_sad,
                <span class="type">gboolean</span>                make_happy,
                <span class="type">gpointer</span>                user_data)
{
  <span class="keyword">if</span> ((make_sad &amp;&amp; make_happy) || (!make_sad &amp;&amp; !make_happy))
    {
      <span class="function"><a href="GDBusMethodInvocation.html#g-dbus-method-invocation-return-dbus-error">g_dbus_method_invocation_return_dbus_error</a></span> (invocation,
                                                  <span class="number">&quot;org.gtk.GDBus.Examples.ObjectManager.Error.Failed&quot;</span>,
                                                  <span class="number">&quot;Exactly one of make_sad or make_happy must be TRUE&quot;</span>);
      <span class="keyword">goto</span> out;
    }

  <span class="keyword">if</span> (make_sad)
    {
      <span class="keyword">if</span> (<span class="function"><a href="../glib/glib-String-Utility-Functions.html#g-strcmp0">g_strcmp0</a></span> (example_animal_get_mood (animal), <span class="number">&quot;Sad&quot;</span>) == <span class="number">0</span>)
        {
          <span class="function"><a href="GDBusMethodInvocation.html#g-dbus-method-invocation-return-dbus-error">g_dbus_method_invocation_return_dbus_error</a></span> (invocation,
                                                      <span class="number">&quot;org.gtk.GDBus.Examples.ObjectManager.Error.SadAnimalIsSad&quot;</span>,
                                                      <span class="number">&quot;Sad animal is already sad&quot;</span>);
          <span class="keyword">goto</span> out;
        }

      example_animal_set_mood (animal, <span class="number">&quot;Sad&quot;</span>);
      example_animal_complete_poke (animal, invocation);
      <span class="keyword">goto</span> out;
    }

  <span class="keyword">if</span> (make_happy)
    {
      <span class="keyword">if</span> (<span class="function"><a href="../glib/glib-String-Utility-Functions.html#g-strcmp0">g_strcmp0</a></span> (example_animal_get_mood (animal), <span class="number">&quot;Happy&quot;</span>) == <span class="number">0</span>)
        {
          <span class="function"><a href="GDBusMethodInvocation.html#g-dbus-method-invocation-return-dbus-error">g_dbus_method_invocation_return_dbus_error</a></span> (invocation,
                                                      <span class="number">&quot;org.gtk.GDBus.Examples.ObjectManager.Error.HappyAnimalIsHappy&quot;</span>,
                                                      <span class="number">&quot;Happy animal is already happy&quot;</span>);
          <span class="keyword">goto</span> out;
        }

      example_animal_set_mood (animal, <span class="number">&quot;Happy&quot;</span>);
      example_animal_complete_poke (animal, invocation);
      <span class="keyword">goto</span> out;
    }

  <span class="preproc">g_assert_not_reached</span> ();

 <span class="keyword">out</span>:
  <span class="keyword">return</span> <span class="number">TRUE</span>; <span class="comment">/*</span><span class="comment"> to indicate that the method was handled </span><span class="comment">*/</span>
}


<span class="type">static</span> <span class="type">void</span>
on_bus_acquired (<span class="type">GDBusConnection</span> *connection,
                 <span class="type">const</span> <span class="type">gchar</span>     *name,
                 <span class="type">gpointer</span>         user_data)
{
  ExampleObjectSkeleton *object;
  <span class="type">guint</span> n;

  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;Acquired a message bus connection</span><span class="symbol">\n</span><span class="number">&quot;</span>);

  <span class="comment">/*</span><span class="comment"> Create a new org.freedesktop.DBus.ObjectManager rooted at /example/Animals </span><span class="comment">*/</span>
  manager = g_dbus_object_manager_server_new (<span class="number">&quot;/example/Animals&quot;</span>);

  <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; <span class="number">10</span>; n++)
    {
      <span class="type">gchar</span> *s;
      ExampleAnimal *animal;

      <span class="comment">/*</span><span class="comment"> Create a new D-Bus object at the path /example/Animals/N where N is 000..009 </span><span class="comment">*/</span>
      s = <span class="function"><a href="../glib/glib-String-Utility-Functions.html#g-strdup-printf">g_strdup_printf</a></span> (<span class="number">&quot;/example/Animals/</span><span class="symbol">%03d</span><span class="number">&quot;</span>, n);
      object = example_object_skeleton_new (s);
      <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> (s);

      <span class="comment">/*</span><span class="comment"> Make the newly created object export the interface</span>
<span class="comment">       * org.gtk.GDBus.Example.ObjectManager.Animal (note</span>
<span class="comment">       * that @object takes its own reference to @animal).</span>
<span class="comment">       </span><span class="comment">*/</span>
      animal = example_animal_skeleton_new ();
      example_animal_set_mood (animal, <span class="number">&quot;Happy&quot;</span>);
      example_object_skeleton_set_animal (object, animal);
      <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> (animal);

      <span class="comment">/*</span><span class="comment"> Cats are odd animals - so some of our objects implement the</span>
<span class="comment">       * org.gtk.GDBus.Example.ObjectManager.Cat interface in addition</span>
<span class="comment">       * to the .Animal interface</span>
<span class="comment">       </span><span class="comment">*/</span>
      <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>)
        {
          ExampleCat *cat;
          cat = example_cat_skeleton_new ();
          example_object_skeleton_set_cat (object, cat);
          <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> (cat);
        }

      <span class="comment">/*</span><span class="comment"> Handle Poke() D-Bus method invocations on the .Animal interface </span><span class="comment">*/</span>
      <span class="preproc">g_signal_connect</span> (animal,
                        <span class="number">&quot;handle-poke&quot;</span>,
                        <span class="preproc">G_CALLBACK</span> (on_animal_poke),
                        <span class="number">NULL</span>); <span class="comment">/*</span><span class="comment"> user_data </span><span class="comment">*/</span>

      <span class="comment">/*</span><span class="comment"> Export the object (@manager takes its own reference to @object) </span><span class="comment">*/</span>
      g_dbus_object_manager_server_export (manager, G_DBUS_OBJECT_SKELETON (object));
      <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> (object);
    }

  <span class="comment">/*</span><span class="comment"> Export all objects </span><span class="comment">*/</span>
  g_dbus_object_manager_server_set_connection (manager, connection);
}

<span class="type">static</span> <span class="type">void</span>
on_name_acquired (<span class="type">GDBusConnection</span> *connection,
                  <span class="type">const</span> <span class="type">gchar</span>     *name,
                  <span class="type">gpointer</span>         user_data)
{
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;Acquired the name </span><span class="symbol">%s</span><span class="symbol">\n</span><span class="number">&quot;</span>, name);
}

<span class="type">static</span> <span class="type">void</span>
on_name_lost (<span class="type">GDBusConnection</span> *connection,
              <span class="type">const</span> <span class="type">gchar</span>     *name,
              <span class="type">gpointer</span>         user_data)
{
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;Lost the name </span><span class="symbol">%s</span><span class="symbol">\n</span><span class="number">&quot;</span>, name);
}


<span class="type">gint</span>
main (<span class="type">gint</span> argc, <span class="type">gchar</span> *argv[])
{
  <span class="type">GMainLoop</span> *loop;
  <span class="type">guint</span> id;

  loop = <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-new">g_main_loop_new</a></span> (<span class="number">NULL</span>, <span class="number">FALSE</span>);

  id = <span class="function"><a href="gio-Owning-Bus-Names.html#g-bus-own-name">g_bus_own_name</a></span> (<span class="number">G_BUS_TYPE_SESSION</span>,
                       <span class="number">&quot;org.gtk.GDBus.Examples.ObjectManager&quot;</span>,
                       <span class="number">G_BUS_NAME_OWNER_FLAGS_ALLOW_REPLACEMENT</span> |
                       <span class="number">G_BUS_NAME_OWNER_FLAGS_REPLACE</span>,
                       on_bus_acquired,
                       on_name_acquired,
                       on_name_lost,
                       loop,
                       <span class="number">NULL</span>);

  <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-run">g_main_loop_run</a></span> (loop);

  <span class="function"><a href="gio-Owning-Bus-Names.html#g-bus-unown-name">g_bus_unown_name</a></span> (id);
  <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-unref">g_main_loop_unref</a></span> (loop);

  <span class="keyword">return</span> <span class="number">0</span>;
}</pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<br class="example-break"><div class="example">
<a name="gdbus-example-codegen-client"></a><p class="title"><b>Example 31. Client-side application using generated code</b></p>
<div class="example-contents">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="preproc">#include </span><span class="number">&quot;gdbus-example-objectmanager-generated.h&quot;</span>

<span class="comment">/*</span><span class="comment"> ---------------------------------------------------------------------------------------------------- </span><span class="comment">*/</span>

<span class="type">static</span> <span class="type">void</span>
print_objects (GDBusObjectManager *manager)
{
  <span class="type">GList</span> *objects;
  <span class="type">GList</span> *l;

  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;Object manager at </span><span class="symbol">%s</span><span class="symbol">\n</span><span class="number">&quot;</span>, g_dbus_object_manager_get_object_path (manager));
  objects = g_dbus_object_manager_get_objects (manager);
  <span class="keyword">for</span> (l = objects; l != <span class="number">NULL</span>; l = l-&gt;next)
    {
      ExampleObject *object = EXAMPLE_OBJECT (l-&gt;data);
      <span class="type">GList</span> *interfaces;
      <span class="type">GList</span> *ll;
      <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot; - Object at </span><span class="symbol">%s</span><span class="symbol">\n</span><span class="number">&quot;</span>, g_dbus_object_get_object_path (G_DBUS_OBJECT (object)));

      interfaces = g_dbus_object_get_interfaces (G_DBUS_OBJECT (object));
      <span class="keyword">for</span> (ll = interfaces; ll != <span class="number">NULL</span>; ll = ll-&gt;next)
        {
          GDBusInterface *interface = G_DBUS_INTERFACE (ll-&gt;data);
          <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;   - Interface </span><span class="symbol">%s</span><span class="symbol">\n</span><span class="number">&quot;</span>, g_dbus_interface_get_info (interface)-&gt;name);

          <span class="comment">/*</span><span class="comment"> Note that @interface is really a GDBusProxy instance - and additionally also</span>
<span class="comment">           * an ExampleAnimal or ExampleCat instance - either of these can be used to</span>
<span class="comment">           * invoke methods on the remote object. For example, the generated function</span>
<span class="comment">           *</span>
<span class="comment">           *  void example_animal_call_poke_sync (ExampleAnimal  *proxy,</span>
<span class="comment">           *                                      gboolean        make_sad,</span>
<span class="comment">           *                                      gboolean        make_happy,</span>
<span class="comment">           *                                      GCancellable   *cancellable,</span>
<span class="comment">           *                                      GError        **error);</span>
<span class="comment">           *</span>
<span class="comment">           * can be used to call the Poke() D-Bus method on the .Animal interface.</span>
<span class="comment">           * Additionally, the generated function</span>
<span class="comment">           *</span>
<span class="comment">           *  const gchar *example_animal_get_mood (ExampleAnimal *object);</span>
<span class="comment">           *</span>
<span class="comment">           * can be used to get the value of the :Mood property.</span>
<span class="comment">           </span><span class="comment">*/</span>
        }
      <span class="function"><a href="../glib/glib-Doubly-Linked-Lists.html#g-list-free-full">g_list_free_full</a></span> (interfaces, <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span>);
    }
  <span class="function"><a href="../glib/glib-Doubly-Linked-Lists.html#g-list-free-full">g_list_free_full</a></span> (objects, <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span>);
}

<span class="type">static</span> <span class="type">void</span>
on_object_added (GDBusObjectManager *manager,
                 GDBusObject        *object,
                 <span class="type">gpointer</span>            user_data)
{
  <span class="type">gchar</span> *owner;
  owner = g_dbus_object_manager_client_get_name_owner (G_DBUS_OBJECT_MANAGER_CLIENT (manager));
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;Added object at </span><span class="symbol">%s</span><span class="number"> (owner </span><span class="symbol">%s</span><span class="number">)</span><span class="symbol">\n</span><span class="number">&quot;</span>, g_dbus_object_get_object_path (object), owner);
  <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> (owner);
}

<span class="type">static</span> <span class="type">void</span>
on_object_removed (GDBusObjectManager *manager,
                   GDBusObject        *object,
                   <span class="type">gpointer</span>            user_data)
{
  <span class="type">gchar</span> *owner;
  owner = g_dbus_object_manager_client_get_name_owner (G_DBUS_OBJECT_MANAGER_CLIENT (manager));
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;Removed object at </span><span class="symbol">%s</span><span class="number"> (owner </span><span class="symbol">%s</span><span class="number">)</span><span class="symbol">\n</span><span class="number">&quot;</span>, g_dbus_object_get_object_path (object), owner);
  <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> (owner);
}

<span class="type">static</span> <span class="type">void</span>
on_notify_name_owner (<span class="type">GObject</span>    *object,
                      <span class="type">GParamSpec</span> *pspec,
                      <span class="type">gpointer</span>    user_data)
{
  GDBusObjectManagerClient *manager = G_DBUS_OBJECT_MANAGER_CLIENT (object);
  <span class="type">gchar</span> *name_owner;

  name_owner = g_dbus_object_manager_client_get_name_owner (manager);
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;name-owner: </span><span class="symbol">%s</span><span class="symbol">\n</span><span class="number">&quot;</span>, name_owner);
  <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> (name_owner);
}

<span class="type">static</span> <span class="type">void</span>
on_interface_proxy_properties_changed (GDBusObjectManagerClient *manager,
                                       GDBusObjectProxy         *object_proxy,
                                       <span class="type">GDBusProxy</span>               *interface_proxy,
                                       <span class="type">GVariant</span>                 *changed_properties,
                                       <span class="type">const</span> <span class="type">gchar</span> *<span class="type">const</span>       *invalidated_properties,
                                       <span class="type">gpointer</span>                  user_data)
{
  <span class="type">GVariantIter</span> iter;
  <span class="type">const</span> <span class="type">gchar</span> *key;
  <span class="type">GVariant</span> *value;
  <span class="type">gchar</span> *s;

  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;Properties Changed on </span><span class="symbol">%s</span><span class="number">:</span><span class="symbol">\n</span><span class="number">&quot;</span>, g_dbus_object_get_object_path (G_DBUS_OBJECT (object_proxy)));
  <span class="function"><a href="../glib/glib-GVariant.html#g-variant-iter-init">g_variant_iter_init</a></span> (&amp;iter, changed_properties);
  <span class="keyword">while</span> (<span class="function"><a href="../glib/glib-GVariant.html#g-variant-iter-next">g_variant_iter_next</a></span> (&amp;iter, <span class="number">&quot;{&amp;sv}&quot;</span>, &amp;key, &amp;value))
    {
      s = <span class="function"><a href="../glib/glib-GVariant.html#g-variant-print">g_variant_print</a></span> (value, <span class="number">TRUE</span>);
      <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;  </span><span class="symbol">%s</span><span class="number"> -&gt; </span><span class="symbol">%s</span><span class="symbol">\n</span><span class="number">&quot;</span>, key, s);
      <span class="function"><a href="../glib/glib-GVariant.html#g-variant-unref">g_variant_unref</a></span> (value);
      <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> (s);
    }
}

<span class="type">gint</span>
main (<span class="type">gint</span> argc, <span class="type">gchar</span> *argv[])
{
  GDBusObjectManager *manager;
  <span class="type">GMainLoop</span> *loop;
  <span class="type">GError</span> *error;
  <span class="type">gchar</span> *name_owner;

  manager = <span class="number">NULL</span>;
  loop = <span class="number">NULL</span>;

  loop = <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-new">g_main_loop_new</a></span> (<span class="number">NULL</span>, <span class="number">FALSE</span>);

  error = <span class="number">NULL</span>;
  manager = example_object_manager_client_new_for_bus_sync (<span class="number">G_BUS_TYPE_SESSION</span>,
                                                            G_DBUS_OBJECT_MANAGER_CLIENT_FLAGS_NONE,
                                                            <span class="number">&quot;org.gtk.GDBus.Examples.ObjectManager&quot;</span>,
                                                            <span class="number">&quot;/example/Animals&quot;</span>,
                                                            <span class="number">NULL</span>, <span class="comment">/*</span><span class="comment"> GCancellable </span><span class="comment">*/</span>
                                                            &amp;error);
  <span class="keyword">if</span> (manager == <span class="number">NULL</span>)
    {
      <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-printerr">g_printerr</a></span> (<span class="number">&quot;Error getting object manager client: </span><span class="symbol">%s</span><span class="number">&quot;</span>, error-&gt;message);
      <span class="function"><a href="../glib/glib-Error-Reporting.html#g-error-free">g_error_free</a></span> (error);
      <span class="keyword">goto</span> out;
    }

  name_owner = g_dbus_object_manager_client_get_name_owner (G_DBUS_OBJECT_MANAGER_CLIENT (manager));
  <span class="function"><a href="../glib/glib-Warnings-and-Assertions.html#g-print">g_print</a></span> (<span class="number">&quot;name-owner: </span><span class="symbol">%s</span><span class="symbol">\n</span><span class="number">&quot;</span>, name_owner);
  <span class="function"><a href="../glib/glib-Memory-Allocation.html#g-free">g_free</a></span> (name_owner);

  print_objects (manager);

  <span class="preproc">g_signal_connect</span> (manager,
                    <span class="number">&quot;notify::name-owner&quot;</span>,
                    <span class="preproc">G_CALLBACK</span> (on_notify_name_owner),
                    <span class="number">NULL</span>);
  <span class="preproc">g_signal_connect</span> (manager,
                    <span class="number">&quot;object-added&quot;</span>,
                    <span class="preproc">G_CALLBACK</span> (on_object_added),
                    <span class="number">NULL</span>);
  <span class="preproc">g_signal_connect</span> (manager,
                    <span class="number">&quot;object-removed&quot;</span>,
                    <span class="preproc">G_CALLBACK</span> (on_object_removed),
                    <span class="number">NULL</span>);
  <span class="preproc">g_signal_connect</span> (manager,
                    <span class="number">&quot;interface-proxy-properties-changed&quot;</span>,
                    <span class="preproc">G_CALLBACK</span> (on_interface_proxy_properties_changed),
                    <span class="number">NULL</span>);

  <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-run">g_main_loop_run</a></span> (loop);

 <span class="keyword">out</span>:
  <span class="keyword">if</span> (manager != <span class="number">NULL</span>)
    <span class="function"><a href="../gobject/gobject-The-Base-Object-Type.html#g-object-unref">g_object_unref</a></span> (manager);
  <span class="keyword">if</span> (loop != <span class="number">NULL</span>)
    <span class="function"><a href="../glib/glib-The-Main-Event-Loop.html#g-main-loop-unref">g_main_loop_unref</a></span> (loop);

  <span class="keyword">return</span> <span class="number">0</span>;
}</pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<br class="example-break">
</div>
</div>
<div class="footer">
<hr>
          Generated by GTK-Doc V1.18.1</div>
</body>
</html>