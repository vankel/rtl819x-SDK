ifeq ($(wildcard $(DIR_LINUX)/.config),)
include ../../linux-2.6.30/.config
DIR_LINUX_KERNEL = ../../linux-2.6.30
else
include $(DIR_LINUX)/.config
DIR_LINUX_KERNEL = $(DIR_LINUX)
endif

ifeq ($(wildcard $(DIR_USERS)/.config),)
include ../.config
else
include $(DIR_USERS)/.config
endif

COMMON_CFLAGS =
SUBDIR=
ifeq ($(CONFIG_APP_RTK_ADAPTER),y)
SUBDIR += rtk_api
endif
ifeq ($(CONFIG_APP_360_ADAPTER),y)
SUBDIR += 360_api
endif
ifeq ($(CONFIG_APP_HAIER_ADAPTER),y)
SUBDIR += haier_api
endif
ifeq ($(CONFIG_APP_RTK_API_TEST_CASE),y)
SUBDIR += test_case
endif
ifdef CONFIG_RTL_AP
AP=1
SKUTAG=ap
else
GW=1
SKUTAG=gw
endif
GATEWAY = -DHOME_GATEWAY
WLANSUPP = -DUNIVERSAL_REPEATER -DWLAN_WPA -DWLAN_WDS -DWLAN_8185AG -DWLAN_WPA2 $(TLS)
WLANSUPP += -DWIFI_SIMPLE_CONFIG
ifeq ($(GW),1)
COMMON_CFLAGS += $(GATEWAY)
endif
ifeq ($(CONFIG_RTL_819X),y)
	COMMON_CFLAGS += -DCONFIG_RTL_819X
endif

ifeq ($(CONFIG_RTL_819XD),y)
	COMMON_CFLAGS += -DCONFIG_RTL_819XD
endif
ifeq ($(CONFIG_RTL_8196B_GW),y)
	COMMON_CFLAGS += -DCONFIG_RTL_8196B
endif

ifeq ($(CONFIG_RTL_8196C_GW),y)
	COMMON_CFLAGS += -DCONFIG_RTL_8196C
endif

ifeq ($(CONFIG_RTL_8198_GW),y)
	COMMON_CFLAGS += -DCONFIG_RTL_8198
endif

ifeq ($(CONFIG_RTL_8198C_GW),y)
	COMMON_CFLAGS += -DCONFIG_RTL_8198
endif

ifeq ($(CONFIG_RTL_8198_AP_ROOT),y)
        COMMON_CFLAGS += -DCONFIG_RTL_8198 -DCONFIG_RTL_8198_AP_ROOT
ifdef CONFIG_8198_PORT5_GMII
	COMMON_CFLAGS += -DGMII_ENABLED
endif
endif

ifeq ($(CONFIG_RTL_8197D_AP),y)
	COMMON_CFLAGS += -DCONFIG_RTL_8197D_AP
endif

ifeq ($(CONFIG_RTL_AP_PACKAGE),y)
	COMMON_CFLAGS += -DCONFIG_RTL_AP_PACKAGE
endif

ifeq ($(CONFIG_RTL_819XD),y)
	COMMON_CFLAGS += -DCONFIG_RTL_819XD
endif

ifeq ($(CONFIG_RTL_8196E),y)
	COMMON_CFLAGS += -DCONFIG_RTL_8196E
endif

ifeq ($(CONFIG_RTL_8198B),y)
	COMMON_CFLAGS += -DCONFIG_RTL_8198B
endif

ifeq ($(CONFIG_RTL_8198C),y)
	COMMON_CFLAGS += -DCONFIG_RTL_8198C
endif

ifeq ($(CONFIG_APP_FWD),y)
COMMON_CFLAGS += -DCONFIG_APP_FWD
endif
ifeq ($(CONFIG_RTL_92D_SUPPORT),y)
COMMON_CFLAGS += -DCONFIG_RTL_92D_SUPPORT
endif

ifeq ($(CONFIG_WLAN_HAL_8881A),y)
ifeq ($(CONFIG_RTL_8881A_SELECTIVE),y)
COMMON_CFLAGS += -DCONFIG_RTL_8881A_SELECTIVE
else
COMMON_CFLAGS += -DCONFIG_RTL_92D_SUPPORT
endif
COMMON_CFLAGS += -DCONFIG_RTL_8812_SUPPORT
COMMON_CFLAGS += -DCONFIG_RTL_11AC_SUPPORT

ifeq ($(CONFIG_USE_PCIE_SLOT_0),y)
COMMON_CFLAGS += -DFOR_DUAL_BAND
COMMON_CFLAGS += -DCONFIG_RTL_DUAL_PCIESLOT_BIWLAN_D
endif
endif

#ifeq ($(CONFIG_RTL_DUAL_92C_8812E),y)
ifeq ($(CONFIG_USE_PCIE_SLOT_0),y)
ifeq ($(CONFIG_USE_PCIE_SLOT_1),y)
ifeq ($(CONFIG_RTL_8812_SUPPORT),y)
COMMON_CFLAGS += -DFOR_DUAL_BAND
COMMON_CFLAGS += -DCONFIG_RTL_92D_SUPPORT
COMMON_CFLAGS += -DCONFIG_RTL_DUAL_PCIESLOT_BIWLAN_D
endif
endif
endif

ifeq ($(CONFIG_APP_RTK_VOIP),y)
COMMON_CFLAGS += -DVOIP_SUPPORT
endif
ifeq ($(CONFIG_APP_SNMP),y)
COMMON_CFLAGS += -DCONFIG_SNMP
endif
COMMON_DFLAGS += -DWIFI_SIMPLE_CONFIG
COMMON_CFLAGS += -DCONFIG_FLASH_SIZE=$(CONFIG_RTL_FLASH_SIZE)
COMMON_CFLAGS += $(WLANSUPP)
ifeq ($(CONFIG_RTK_VLAN_SUPPORT),y)
COMMON_CFLAGS += -DVLAN_CONFIG_SUPPORTED
endif
 
ifeq ($(CONFIG_RTK_VLAN_NEW_FEATURE),y)
        COMMON_CFLAGS += -DCONFIG_RTK_VLAN_NEW_FEATURE
endif
ifeq ($(CONFIG_RTL_HW_VLAN_SUPPORT),y)
        COMMON_CFLAGS += -DCONFIG_RTL_HW_VLAN_SUPPORT
endif
 
ifeq ($(GW),1)
        COMMON_CFLAGS += -DQOS_BY_BANDWIDTH
ifeq ($(CONFIG_APP_QOS_MNP),y)
COMMON_CFLAGS += -DCONFIG_RTL_QOS_MONOPOLY_SUPPORT
endif
endif

ifeq ($(CONFIG_USB_SERIAL_OPTION),y)
COMMON_CFLAGS += -DRTK_USB3G
endif

ifeq ($(CONFIG_RTL_DEF_SETTING_IN_FW),y)
COMMON_CFLAGS += -DRTL_DEF_SETTING_IN_FW
endif

ifeq ($(CONFIG_RTL_WAPI_SUPPORT),y)
COMMON_CFLAGS += -DCONFIG_RTL_WAPI_SUPPORT
ifeq ($(CONFIG_RTL_WAPI_LOCAL_AS_SUPPORT),y)
COMMON_CFLAGS += -DCONFIG_RTL_WAPI_LOCAL_AS_SUPPORT
endif
endif

ifeq ($(CONFIG_RTL_DNS_TRAP),y)
COMMON_CFLAGS += -DCONFIG_RTL_DNS_TRAP
endif

ifeq ($(CONFIG_RTL_HTTP_REDIRECT),y)
COMMON_CFLAGS += -DCONFIG_RTL_HTTP_REDIRECT
endif

COMMON_CFLAGS += -DLE_UI_SUPPORT

ifeq ($(CONFIG_RTL_802_1X_CLIENT_SUPPORT),y)
COMMON_CFLAGS += -DCONFIG_RTL_802_1X_CLIENT_SUPPORT
endif

COMMON_CFLAGS += -DCONFIG_DYNAMIC_WAN_IP
COMMON_CFLAGS += -DCONFIG_GET_SERVER_IP_BY_DOMAIN

ifeq ($(CONFIG_RTK_SUPPORT_DHCP_PORT_IP_BIDN),y)
COMMON_CFLAGS += -DSUPPORT_DHCP_PORT_IP_BIND
COMMON_CFLAGS += -DCONFIG_RTL_BIND_IP_FOR_PORTFWD
endif

ifeq ($(CONFIG_LIB_MXML),y)
ifeq ($(CONFIG_CGI_CLIENT),y)
ifeq ($(CONFIG_APP_CURL),y)
COMMON_CFLAGS += -DCGI_SUPPORT
endif
endif
endif
export COMMON_CFLAGS

all: $(SUBDIR)
	for i in $(SUBDIR) ; do \
       $(MAKE) -C $$i || exit "$$?"; \
	done

clean: $(SUBDIR)
	for i in $(SUBDIR) ; do \
       $(MAKE) -C $$i clean || exit "$$?"; \
	done

romfs: $(SUBDIR)
	for i in $(SUBDIR) ; do \
       $(MAKE) -C $$i romfs || exit "$$?"; \
	done
