#
# Copyright (C) 2011 Realtek Semiconductor Corp.
#
# Makefile for SDK Diag Shell Source
#

APOLLO_SDK_PATH = $(SDKDIR)

include $(APOLLO_SDK_PATH)/../Compiler_Flag


LIB = $(APOLLO_SDK_PATH)/unittest/libut.a
LIB += $(APOLLO_SDK_PATH)/src/librtk.a

LIB += -l pthread

#ASIC mode
CFLAGS := -DRTK_X86_CLE -DRTK_X86_ASICDRV -DCONFIG_APOLLO_CMD -DCONFIG_SMIDA1011 -DDISABLE_VLAN_SHADOW -DCONFIG_LINUX_USER_SHELL


SDK_ROOT_DIR = $(APOLLO_SDK_PATH)
SDK_INCLUDE   = $(SDK_ROOT_DIR)/include
SYS_DIR = $(SDK_ROOT_DIR)/system/linux
SYS_INCLUDE = $(SDK_ROOT_DIR)/system/include
RTUSR_INC = $(SYS_DIR)/rtk/rtusr/include
COMMON_DIR = $(SDK_ROOT_DIR)/src/common
UT_INCLUDE   = $(SDK_ROOT_DIR)/unittest

ifeq ($(CONFIG_DIAGSHELL_MODE),CONFIG_DIAGSHELL_RTK)
DIAGSHELL_DIR := ../../../sdk/src/app/diag_rtk
endif

ifeq ($(CONFIG_DIAGSHELL_MODE),CONFIG_DIAGSHELL_RAW)
DIAGSHELL_DIR := ../../../sdk/src/app/diag
endif

DIAG_INCLUDE  = $(DIAGSHELL_DIR)/include
DIAGSHELL_SRC_DIR := $(DIAGSHELL_DIR)/src
DIAG_CFG = $(DIAGSHELL_DIR)/config


INCLUDE += -I$(DIAG_INCLUDE) \
           -I$(SDK_INCLUDE) \
           -I$(SYS_INCLUDE) \
           -I$(SDK_INCLUDE)/hal/chipdef/apollo \
           -I$(UT_INCLUDE) \
           -I.. \

CFLAGS += -DCONFIG_RTL865X \
          -DCONFIG_RTL865XC \
          -DRTL865X_MODEL_USER \
          -D_LITTLE_ENDIAN \


EXEC = diag
BIN = bin
TARGET := obj
#SRC = $(CMDS)
#OBJ += $(shell for i in $(SRC); do n=`basename $$i`; echo -n $(TARGET)/$${n%%.*}.o ""; done)
OBJ :=  $(DIAGSHELL_SRC_DIR)/diag_main.o \
	    $(DIAGSHELL_SRC_DIR)/diag_util.o \
        $(DIAGSHELL_SRC_DIR)/diag_str.o \
	    $(DIAGSHELL_SRC_DIR)/diag_om.o

ifeq ($(CONFIG_DIAGSHELL_MODE),CONFIG_DIAGSHELL_RAW)
ifeq ($(CONFIG_SDK_APOLLO),y)
OBJ += \
        $(DIAGSHELL_SRC_DIR)/parser/cparser.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_fsm.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_io_unix.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_line.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_token.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_token_tbl.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_tree.o \
	    $(DIAGSHELL_SRC_DIR)/diag_cmd.o \
        $(DIAGSHELL_SRC_DIR)/diag_debug.o \
        $(DIAGSHELL_SRC_DIR)/diag_sdk.o \
        $(DIAGSHELL_SRC_DIR)/diag_reg.o \
        $(DIAGSHELL_SRC_DIR)/diag_l2.o \
        $(DIAGSHELL_SRC_DIR)/diag_vlan.o \
        $(DIAGSHELL_SRC_DIR)/diag_svlan.o \
        $(DIAGSHELL_SRC_DIR)/diag_mirror.o \
        $(DIAGSHELL_SRC_DIR)/diag_port.o \
        $(DIAGSHELL_SRC_DIR)/diag_qos.o \
        $(DIAGSHELL_SRC_DIR)/diag_dot1x.o \
        $(DIAGSHELL_SRC_DIR)/diag_trunk.o \
        $(DIAGSHELL_SRC_DIR)/diag_rate.o \
        $(DIAGSHELL_SRC_DIR)/diag_oam.o \
        $(DIAGSHELL_SRC_DIR)/diag_trap.o \
        $(DIAGSHELL_SRC_DIR)/diag_counter.o \
        $(DIAGSHELL_SRC_DIR)/diag_acl.o \
        $(DIAGSHELL_SRC_DIR)/diag_ext.o \
        $(DIAGSHELL_SRC_DIR)/diag_gpon.o \
        $(DIAGSHELL_SRC_DIR)/diag_classf.o \
        $(DIAGSHELL_SRC_DIR)/diag_l34.o \
        $(DIAGSHELL_SRC_DIR)/diag_sec.o \
        $(DIAGSHELL_SRC_DIR)/diag_stp.o \
        $(DIAGSHELL_SRC_DIR)/diag_switch.o \
        $(DIAGSHELL_SRC_DIR)/diag_flowctrl.o \
        $(DIAGSHELL_SRC_DIR)/diag_auto_fallback.o \
        $(DIAGSHELL_SRC_DIR)/diag_eee.o \
        $(DIAGSHELL_SRC_DIR)/diag_cpu.o \
        $(DIAGSHELL_SRC_DIR)/diag_intr.o \
        $(DIAGSHELL_SRC_DIR)/diag_rldp.o \
        $(DIAGSHELL_SRC_DIR)/diag_ponmac.o
endif
endif


ifeq ($(CONFIG_DIAGSHELL_MODE),CONFIG_DIAGSHELL_RTK)
OBJ += \
        $(DIAGSHELL_SRC_DIR)/parser/cparser.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_fsm.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_io_unix.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_line.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_token.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_token_tbl.o \
        $(DIAGSHELL_SRC_DIR)/parser/cparser_tree.o \
        $(DIAGSHELL_SRC_DIR)/diag_cmd.o \
    	$(DIAGSHELL_SRC_DIR)/diag_sdk.o \
    	$(DIAGSHELL_SRC_DIR)/diag_reg.o \
        $(DIAGSHELL_SRC_DIR)/diag_acl.o \
        $(DIAGSHELL_SRC_DIR)/diag_vlan.o \
        $(DIAGSHELL_SRC_DIR)/diag_l2.o \
        $(DIAGSHELL_SRC_DIR)/diag_igmp.o \
        $(DIAGSHELL_SRC_DIR)/diag_port.o \
        $(DIAGSHELL_SRC_DIR)/diag_mirror.o \
        $(DIAGSHELL_SRC_DIR)/diag_classf.o \
        $(DIAGSHELL_SRC_DIR)/diag_l34.o \
        $(DIAGSHELL_SRC_DIR)/diag_qos.o \
        $(DIAGSHELL_SRC_DIR)/diag_bandwidth.o \
        $(DIAGSHELL_SRC_DIR)/diag_meter.o \
        $(DIAGSHELL_SRC_DIR)/diag_switch.o \
        $(DIAGSHELL_SRC_DIR)/diag_storm_control.o \
        $(DIAGSHELL_SRC_DIR)/diag_dot1x.o \
        $(DIAGSHELL_SRC_DIR)/diag_stp.o \
        $(DIAGSHELL_SRC_DIR)/diag_counter.o \
        $(DIAGSHELL_SRC_DIR)/diag_trunk.o \
        $(DIAGSHELL_SRC_DIR)/diag_trap.o \
        $(DIAGSHELL_SRC_DIR)/diag_rma.o \
        $(DIAGSHELL_SRC_DIR)/diag_oam.o \
        $(DIAGSHELL_SRC_DIR)/diag_sec.o \
        $(DIAGSHELL_SRC_DIR)/diag_cpu.o \
    	$(DIAGSHELL_SRC_DIR)/diag_iol.o \
    	$(DIAGSHELL_SRC_DIR)/diag_svlan.o \
    	$(DIAGSHELL_SRC_DIR)/diag_debug.o \
        $(DIAGSHELL_SRC_DIR)/diag_flowctrl.o \
    	$(DIAGSHELL_SRC_DIR)/diag_auto_fallback.o \
    	$(DIAGSHELL_SRC_DIR)/diag_epon.o \
    	$(DIAGSHELL_SRC_DIR)/diag_ponmac.o \
    	$(DIAGSHELL_SRC_DIR)/diag_rldp.o \
    	$(DIAGSHELL_SRC_DIR)/diag_intr.o \
        $(DIAGSHELL_SRC_DIR)/diag_gpon.o
endif



#RM_EXE:
#	rm -f $(BIN)/$(EXEC)



$(EXEC): $(OBJ)
	$(CC) $(CFLAGS) $(EXTRA_CFLAGS) $(INCLUDE) $(OBJ) $(LIB) -o $(BIN)/$@
	$(STRIP) $(BIN)/$@

$(TARGET)/%.o: %.c
	$(CC) $(INCLUDE) $(CFLAGS) $(EXTRA_CFLAGS) -c -o $@ $<

%.o: %.c
	$(CC) $(INCLUDE) $(CFLAGS) $(EXTRA_CFLAGS) -c -o $@ $<



#all: RM_EXE $(EXEC)


install: $(EXEC)
	cp $(EXEC) $(BINDIR)

clean:
	rm -f $(OBJ) $(BIN)/$(EXEC) *.gdb *.elf *.elf2flt

tgz: clean
	cd ..; cd ..; tar zcvf $(EXEC).tgz $(EXEC)

