<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIP Interface: Main Page2</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<img src=realtek.jpg>
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">fxs.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example for FXS operation.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="voip__manager_8h.html" title="VoIP control API.">voip_manager.h</a>&quot;</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *  FXS sample code.</span></div>
<div class="line"><span class="comment"> *  Fxs0 and fxs1 are connected when off-hook handsets.</span></div>
<div class="line"><span class="comment"> *  Please killall solar_monitor before running this sample code.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> chid;</div>
<div class="line">    <span class="keywordtype">int</span> dtmf_mode;</div>
<div class="line">    <a class="code" href="voip__manager_8h.html#ac3d830d3c2e104857c0628ae98e456f8">SIGNSTATE</a> val;</div>
<div class="line">    <a name="_a0"></a><a class="code" href="structrtp__config__t.html" title="Structure for RTP handling  ">rtp_config_t</a> rtp_config;</div>
<div class="line">    <a name="_a1"></a><a class="code" href="structpayloadtype__config__t.html" title="Structure for RTP payload type  ">payloadtype_config_t</a> codec_config;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> codec_select = 0;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(argc &lt; 2)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;usage: %s DTMF_MODE(0:RFC2833 / 1:SIP_INFO / 2:INBAND) [codec] \n&quot;</span>, argv[0]);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( atoi(argv[1])!=0 &amp;&amp; atoi(argv[1])!=1 &amp;&amp; atoi(argv[1])!=2)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;DTMF_MODE: RFC2833(0) SIP_INFO(1) INBAND(2)\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    dtmf_mode = atoi(argv[1]);</div>
<div class="line">    <span class="keywordflow">if</span>( argc &gt;= 3 )</div>
<div class="line">        codec_select = atoi( argv[ 2 ] ); </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(chid = 0 ; chid &lt;CON_CH_NUM ;chid ++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>( !RTK_VOIP_IS_SLIC_CH( chid, <a name="a2"></a><a class="code" href="voip__manager_8h.html#a7ac8ef5ad9f078d6a0cff032bd14c4a2" title="The variables contaions the VoIP Feature.">g_VoIP_Feature</a> ) )</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">            </div>
<div class="line">        <a name="a3"></a><a class="code" href="group__TAPI__DSP__INIT.html#ga4b32be720cdd238fb82cf0bad3db2114" title="Interface Initialization.">rtk_InitDsp</a>(chid);</div>
<div class="line">        <a name="a4"></a><a class="code" href="group__TAPI__PHONE__EVENT.html#ga360048e105becaf697d40d0319655470" title="Flush the VoIP kernel used FIFO.">rtk_SetFlushFifo</a>(chid); </div>
<div class="line">        <a name="a5"></a><a class="code" href="group__TAPI__DSP__CID__DTMF.html#gab8245d14b7a7a684e1aa25e1188c137b" title="Set the DTMF mode.">rtk_SetDtmfMode</a>(chid, dtmf_mode);   <span class="comment">// set dtmf mode</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {   <span class="keywordflow">for</span>(chid = 0 ; chid &lt;CON_CH_NUM ; chid ++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span>( !RTK_VOIP_IS_SLIC_CH( chid, <a class="code" href="voip__manager_8h.html#a7ac8ef5ad9f078d6a0cff032bd14c4a2" title="The variables contaions the VoIP Feature.">g_VoIP_Feature</a> ) )</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            </div>
<div class="line">            <a name="a6"></a><a class="code" href="group__TAPI__OBSOLETE__GROUP.html#ga09c56bc79918bd82b057736c05905fde" title="Get the FXS state.">rtk_GetFxsEvent</a>(chid, &amp;val);</div>
<div class="line">            <span class="keywordflow">switch</span> (val)</div>
<div class="line">            {</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY1:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY2:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY3:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY4:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY5:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY6:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY7:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY8:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY9:</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_KEY0:</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_STAR:</div>
<div class="line">                <a name="a7"></a><a class="code" href="group__TAPI__DSP__IVR.html#ga2ad3fcb2f5f203961911d459147f5077" title="Play a text speech.">rtk_IvrStartPlaying</a>  (chid, 0, <a name="a8"></a><a class="code" href="voip__params_8h.html#aa9cf43e23f63075e95a1f24ae4e6f2deaf3b7b6ba534cffe132bfe420d2af7b2c" title="IVR local direction.">IVR_DIR_LOCAL</a>, <span class="stringliteral">&quot;STAR&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_HASH:</div>
<div class="line">                <a class="code" href="group__TAPI__DSP__IVR.html#ga2ad3fcb2f5f203961911d459147f5077" title="Play a text speech.">rtk_IvrStartPlaying</a>  (chid, 0, <a name="a9"></a><a class="code" href="voip__params_8h.html#aa9cf43e23f63075e95a1f24ae4e6f2dea0c1e8b2564882a8b3f0d01eaadf09eb7" title="IVR remote direction.">IVR_DIR_REMOTE</a>, <span class="stringliteral">&quot;HASH&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> SIGN_OFFHOOK:</div>
<div class="line"></div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * call rtk_OffHookAction at first</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <a name="a10"></a><a class="code" href="group__TAPI__PHONE__MISC.html#gad0fba4da59d7db9bb24f88ca30c2ad34" title="OffHook Action function. Call this TAPI always when Off-Hook event is got.">rtk_OffHookAction</a>(chid);</div>
<div class="line">                <a name="a11"></a><a class="code" href="group__TAPI__MEDIA__MISC.html#gaed19a0479f028247263e839f224c7f56" title="Assign the active session.">rtk_SetTranSessionID</a>(chid, 0);</div>
<div class="line">    </div>
<div class="line">                <span class="comment">/*      </span></div>
<div class="line"><span class="comment">                 * set RTP session</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                memset(&amp;rtp_config, 0, <span class="keyword">sizeof</span>(rtp_config));</div>
<div class="line">                rtp_config.<a name="a12"></a><a class="code" href="structrtp__config__t.html#a6835ba1d83a5bcc4bd0af7d83076ea6a" title="channel id">chid</a>     = chid;     <span class="comment">// use channel </span></div>
<div class="line">                rtp_config.<a name="a13"></a><a class="code" href="structrtp__config__t.html#ae30a7620430762b93c1792477cb0eaeb" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>      = 0;</div>
<div class="line">                rtp_config.<a name="a14"></a><a class="code" href="structrtp__config__t.html#a1630c48e70b3818c1b46fa3d2ee0a8ef" title="Not support yet. tcp = 1 or udp = 0.">isTcp</a>    = 0;        <span class="comment">// use udp</span></div>
<div class="line">                rtp_config.<a name="a15"></a><a class="code" href="structrtp__config__t.html#ab99c37801711581655f5833a38f70044" title="local IP address for RTP">extIp</a>    = inet_addr(<span class="stringliteral">&quot;127.0.0.1&quot;</span>);</div>
<div class="line">                rtp_config.<a name="a16"></a><a class="code" href="structrtp__config__t.html#a959b92e3bb71c4d081f1dd7975906d9f" title="remote IP address for RTP">remIp</a>    = inet_addr(<span class="stringliteral">&quot;127.0.0.1&quot;</span>);</div>
<div class="line">                rtp_config.<a name="a17"></a><a class="code" href="structrtp__config__t.html#ae95db080a339d14e8c5860a689d55e35" title="local RTP port number">extPort</a>  = htons(9000 + chid);</div>
<div class="line">                rtp_config.<a name="a18"></a><a class="code" href="structrtp__config__t.html#a427f96d3294a74896580c54c2fa8a171" title="remote RTP port number">remPort</a>  = htons(9000 + (chid ? 0 : 1));</div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_VOICE_QOS</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config.tos      = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">                <span class="keywordflow">if</span>(dtmf_mode == DTMF_RFC2833)</div>
<div class="line">                {</div>
<div class="line">                    rtp_config.<a name="a19"></a><a class="code" href="structrtp__config__t.html#a217fe384b06c22665689c5c558ed795d" title="local rfc2833 payload type  rfc2833_payload_type_locale MUST be set from application to DSP...">rfc2833_payload_type_local</a>   = 96;</div>
<div class="line">                    rtp_config.<a name="a20"></a><a class="code" href="structrtp__config__t.html#aa50cbeaa509c7554e85fe2c125ed6cca" title="remote rfc2833 payload type  rfc2833_payload_type_remote MUST be set from application to DSP...">rfc2833_payload_type_remote</a>  = 96;</div>
<div class="line">                    rtp_config.<a name="a21"></a><a class="code" href="structrtp__config__t.html#ad5526fa524c914af80c5ab112b850536" title="local Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_local</a> = 101;</div>
<div class="line">                    rtp_config.<a name="a22"></a><a class="code" href="structrtp__config__t.html#a65be43b15030c9d62a09e47e5c670841" title="remote Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_remote</a> = 101;</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#if defined(SUPPORT_RTP_REDUNDANT_APP)</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config.<a name="a23"></a><a class="code" href="structrtp__config__t.html#abacf7214ccfa686dde4da5c47797fb7f" title="Payload type of local redundant rtp. 0 means disable rtp redundant.">rtp_redundant_payload_type_local</a>  = 0;</div>
<div class="line">                rtp_config.<a name="a24"></a><a class="code" href="structrtp__config__t.html#a584d18c8335c56d12c61a324af24eab8" title="Payload type of remote redundant rtp 0 means disable rtp redundant.">rtp_redundant_payload_type_remote</a> = 0;</div>
<div class="line">                rtp_config.<a name="a25"></a><a class="code" href="structrtp__config__t.html#aefa61ecebb4c33ad03b235b7d8282e56" title="Maximum RTP redundancy number in TX direction (0~2). 0 means no RTP redundancy.">rtp_redundant_max_Audio</a> = 0;</div>
<div class="line">                rtp_config.<a name="a26"></a><a class="code" href="structrtp__config__t.html#a5649f8db4f869bb73fc3d9337ba7cb98" title="Maximum RFC 2833 redundancy number in TX direction (0~5). 0 means no RFC 2833 redundancy.">rtp_redundant_max_RFC2833</a> = 0;</div>
<div class="line"><span class="preprocessor">#elif defined(SUPPORT_RTP_REDUNDANT)</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config.<a class="code" href="structrtp__config__t.html#abacf7214ccfa686dde4da5c47797fb7f" title="Payload type of local redundant rtp. 0 means disable rtp redundant.">rtp_redundant_payload_type_local</a>  = 0;</div>
<div class="line">                rtp_config.<a class="code" href="structrtp__config__t.html#a584d18c8335c56d12c61a324af24eab8" title="Payload type of remote redundant rtp 0 means disable rtp redundant.">rtp_redundant_payload_type_remote</a> = 0;</div>
<div class="line">                rtp_config.<a class="code" href="structrtp__config__t.html#aefa61ecebb4c33ad03b235b7d8282e56" title="Maximum RTP redundancy number in TX direction (0~2). 0 means no RTP redundancy.">rtp_redundant_max_Audio</a> = 0;</div>
<div class="line">                rtp_config.<a class="code" href="structrtp__config__t.html#a5649f8db4f869bb73fc3d9337ba7cb98" title="Maximum RFC 2833 redundancy number in TX direction (0~5). 0 means no RFC 2833 redundancy.">rtp_redundant_max_RFC2833</a> = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config.<a name="a27"></a><a class="code" href="structrtp__config__t.html#ae539171a25479d0ef291c01aea8741c8" title="Payload type of local SID (Silence Insertion Description). 13 is recommend.">SID_payload_type_local</a>  = 0;</div>
<div class="line">                rtp_config.<a name="a28"></a><a class="code" href="structrtp__config__t.html#a251fe201cd44524df63f076a8756ad71" title="Payload type of remote SID (Silence Insertion Description). 13 is recommend.">SID_payload_type_remote</a> = 0;</div>
<div class="line">                rtp_config.<a name="a29"></a><a class="code" href="structrtp__config__t.html#a864753145110bf95e0a4b86ad32a2dcc" title="initialize seqno, SSRC and timestamp randomly, so ignore below parameters">init_randomly</a> = 1;</div>
<div class="line">                rtp_config.<a name="a30"></a><a class="code" href="structrtp__config__t.html#ab2fdc41617ee0e672181577c00944219" title="initial seqno">init_seqno</a> = 0;</div>
<div class="line">                rtp_config.<a name="a31"></a><a class="code" href="structrtp__config__t.html#abf984d1afc9ee6616d163d1ecc04b28d" title="initial SSRC">init_SSRC</a> = 0;</div>
<div class="line">                rtp_config.<a name="a32"></a><a class="code" href="structrtp__config__t.html#a70cd97dacde76a2364592cc3db18a0be" title="initial timestamp">init_timestamp</a> = 0;</div>
<div class="line">                <a name="a33"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#ga20fe6f6be15faef8c57328ab22f95393" title="Set RTP configuration.">rtk_SetRtpConfig</a>(&amp;rtp_config);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">                <span class="comment">/* </span></div>
<div class="line"><span class="comment">                 * set rtp payload, and other session parameters.</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                codec_config.<a name="a34"></a><a class="code" href="structpayloadtype__config__t.html#a7a81ef5b12c7b2c492e2f466402b3fba" title="channel id">chid</a>            = chid;</div>
<div class="line">                codec_config.<a name="a35"></a><a class="code" href="structpayloadtype__config__t.html#a717481154070dc5fe2399c656c661ace" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>             = 0;</div>
<div class="line">                codec_config.<a name="a36"></a><a class="code" href="structpayloadtype__config__t.html#af983fd7e21d7a15b3e01dd835a070261" title="Payload type of local voice codec.">local_pt</a>        = 18;                  <span class="comment">// G729 use static pt 18</span></div>
<div class="line">                codec_config.<a name="a37"></a><a class="code" href="structpayloadtype__config__t.html#a715fb4beb036ad7703243258c88e4c9a" title="Payload type of remote voice codec.">remote_pt</a>       = 18;                  <span class="comment">// G729 use static pt 18</span></div>
<div class="line">                <span class="keywordflow">switch</span>( codec_select ) {</div>
<div class="line">                <span class="keywordflow">case</span> 711:</div>
<div class="line">                    codec_config.<a name="a38"></a><a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a>  = rtpPayloadPCMU;     <span class="comment">// for TX to remote</span></div>
<div class="line">                    codec_config.<a name="a39"></a><a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a> = rtpPayloadPCMU;     <span class="comment">// for RX from remote</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 722:</div>
<div class="line">                    codec_config.<a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a>  = rtpPayloadG722;     <span class="comment">// for TX to remote</span></div>
<div class="line">                    codec_config.<a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a> = rtpPayloadG722;     <span class="comment">// for RX from remote</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 723:</div>
<div class="line">                    codec_config.<a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a>  = rtpPayloadG723;     <span class="comment">// for TX to remote</span></div>
<div class="line">                    codec_config.<a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a> = rtpPayloadG723;     <span class="comment">// for RX from remote</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 729:</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    codec_config.<a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a>  = rtpPayloadG729;     <span class="comment">// for TX to remote</span></div>
<div class="line">                    codec_config.<a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a> = rtpPayloadG729;     <span class="comment">// for RX from remote</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                codec_config.<a name="a40"></a><a class="code" href="structpayloadtype__config__t.html#aac8c4492c426f10e4ee22ce5838c801b" title="Payload type of local voice band data (vbd).">local_pt_vbd</a>    = rtpPayloadUndefined;</div>
<div class="line">                codec_config.<a name="a41"></a><a class="code" href="structpayloadtype__config__t.html#a45b5dd95db0de40fe811c2c890fc716d" title="Payload type in remote voice band data (vbd).">remote_pt_vbd</a>   = rtpPayloadUndefined;</div>
<div class="line">                codec_config.<a name="a42"></a><a class="code" href="structpayloadtype__config__t.html#ada6bbf4c14e274e6adc90ac51a38494c" title="Codec type of voice band data (vbd). Usually used by V.152 FAX.">uPktFormat_vbd</a>  = rtpPayloadUndefined;</div>
<div class="line">                codec_config.<a name="a43"></a><a class="code" href="structpayloadtype__config__t.html#a51db5ebb75d4929816d0aa4967d2bc49" title="G.723.1 rate. There are two bit rates at which G.723.1 can operate.  Valid values are:  0: 6...">nG723Type</a>       = 0;</div>
<div class="line">                codec_config.<a name="a44"></a><a class="code" href="structpayloadtype__config__t.html#a921c890c8d1f7ae8b8cc0cabf27bf778" title="Frame per packet of local (Tx) voice codec.">nLocalFramePerPacket</a> = 1;</div>
<div class="line">                codec_config.<a name="a45"></a><a class="code" href="structpayloadtype__config__t.html#a5ec2b162f986c6016bf17dddd98c93d3" title="Frame per packet of remote (Rx) voice codec.">nRemoteFramePerPacket</a> = 1;</div>
<div class="line">                codec_config.<a name="a46"></a><a class="code" href="structpayloadtype__config__t.html#a0760774c59b4302c41a13c3f20ee971e" title="Frame per packet of voice codec (vbd)">nFramePerPacket_vbd</a> = 1;</div>
<div class="line">                codec_config.<a name="a47"></a><a class="code" href="structpayloadtype__config__t.html#aba143d7f2f2e9130cc729056b3668e66" title="Enable/Disable VAD (Voice activity detection)  Valid values are: 0: Disable 1: Enable.">bVAD</a>            = 0;</div>
<div class="line">                codec_config.<a name="a48"></a><a class="code" href="structpayloadtype__config__t.html#ae31dc1e199838d927b4ff751e4dc4d5a" title="Enable/Disable PLC (Packet Loss Concealment)  Valid values are: 0: Disable 1: Enable.">bPLC</a>            = 1;</div>
<div class="line">                codec_config.<a name="a49"></a><a class="code" href="structpayloadtype__config__t.html#a671c4ba30e9bb37f85ea34c722c769d1" title="G726 packing order  Valid values are:  0: Packing none 1: Packing left 2: Packing right...">nG726Packing</a>    = 2;</div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>                codec_config.<a name="a50"></a><a class="code" href="structpayloadtype__config__t.html#a5edd303e38c49d0870ae64c0682b0bd1" title="minimun jitter delay (10ms)  nJitterDelay is the minimum delay of jitter buffer.  Valid values are 4 ...">nJitterDelay</a>    = 4;</div>
<div class="line">                codec_config.<a name="a51"></a><a class="code" href="structpayloadtype__config__t.html#a1cf71efa5a26840869adc9ce70812506" title="maximum jitter delay (10ms)  nJitterDelay is the maximum delay of jitter buffer.  Valid values are 13...">nMaxDelay</a>       = 13;</div>
<div class="line">                codec_config.<a name="a52"></a><a class="code" href="structpayloadtype__config__t.html#a2994da36a394d9edf2ff126817181e48" title="maximum strict jitter delay (10ms)  nMaxStrictDelay is the maximum strict delay of jitter buffer...">nMaxStrictDelay</a> = 10000;</div>
<div class="line">                codec_config.<a name="a53"></a><a class="code" href="structpayloadtype__config__t.html#a2435652e35b35df20454edaeca7942d0" title="optimzation factor of jitter buffer  The optimization factor is the value for adjusting the quality o...">nJitterFactor</a>   = 7;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>                codec_config.<a class="code" href="structpayloadtype__config__t.html#a5edd303e38c49d0870ae64c0682b0bd1" title="minimun jitter delay (10ms)  nJitterDelay is the minimum delay of jitter buffer.  Valid values are 4 ...">nJitterDelay</a>    = 4;</div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#a1cf71efa5a26840869adc9ce70812506" title="maximum jitter delay (10ms)  nJitterDelay is the maximum delay of jitter buffer.  Valid values are 13...">nMaxDelay</a>       = 20;</div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#a2994da36a394d9edf2ff126817181e48" title="maximum strict jitter delay (10ms)  nMaxStrictDelay is the maximum strict delay of jitter buffer...">nMaxStrictDelay</a> = 10000;</div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#a2435652e35b35df20454edaeca7942d0" title="optimzation factor of jitter buffer  The optimization factor is the value for adjusting the quality o...">nJitterFactor</a>   = 1;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">                <span class="keywordflow">if</span> ((codec_config.<a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a> == rtpPayloadG722) ||</div>
<div class="line">                    (codec_config.<a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a> == rtpPayloadG722) )</div>
<div class="line">                    codec_config.<a name="a54"></a><a class="code" href="structpayloadtype__config__t.html#ad82d877ec1c901972f53d166a936c27f" title="PCM Mode Setting  Valid values are:  0: No action (use previous PCM enable mode)  1: Auto mode (DSP w...">nPcmMode</a> = 3;  <span class="comment">// wide-band</span></div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    codec_config.<a class="code" href="structpayloadtype__config__t.html#ad82d877ec1c901972f53d166a936c27f" title="PCM Mode Setting  Valid values are:  0: No action (use previous PCM enable mode)  1: Auto mode (DSP w...">nPcmMode</a> = 2;  <span class="comment">// narrow-band</span></div>
<div class="line"></div>
<div class="line">                <a name="a55"></a><a class="code" href="group__TAPI__DSP__MEDIA.html#ga66c7ebfb55ed123876274a6f61ee6ded" title="Set RTP payload type.">rtk_SetRtpPayloadType</a>(&amp;codec_config);</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* </span></div>
<div class="line"><span class="comment">                 * start rtp (channel number = 0, session number = 0)</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <a name="a56"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, 0, <a name="a57"></a><a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa594fa9c4862d7d3d0dba9d0f4e231eea" title="RTP Session- Send/Recv.">rtp_session_sendrecv</a>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">            <span class="keywordflow">case</span> SIGN_ONHOOK:</div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * close rtp</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, 0, <a name="a58"></a><a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa0f1821892441a90141e10d5e947e912e" title="RTP Session- Inactive.">rtp_session_inactive</a>);</div>
<div class="line"></div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * call rtk_OnHookAction at last</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                 </div>
<div class="line">                <a name="a59"></a><a class="code" href="group__TAPI__PHONE__MISC.html#ga11966890f2e1cacc13e3f525758d2636" title="OnHook Action function. Call this TAPI always when On-Hook event is got.">rtk_OnHookAction</a>(chid);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        usleep(100000); <span class="comment">// 100ms</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 3 2014 11:37:43 for VoIP Interface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
