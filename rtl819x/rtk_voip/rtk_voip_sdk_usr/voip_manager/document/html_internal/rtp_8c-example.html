<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIP Interface: Main Page2</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<img src=realtek.jpg>
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">rtp.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example for send RTP</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="voip__manager_8h.html" title="VoIP control API.">voip_manager.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//#define SUPPORT_RFC2833</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *  RTP sample code.</span></div>
<div class="line"><span class="comment"> *  Send RTP and RTCP to specific IP address and port number when </span></div>
<div class="line"><span class="comment"> *  off-hook handset. Press flash-hook to hold/resume RTP. </span></div>
<div class="line"><span class="comment"> *  User hears a tone ,sounds like du du du, when the call is held.</span></div>
<div class="line"><span class="comment"> *  ATA sends RFC 2833 packets when user press phone digit key.</span></div>
<div class="line"><span class="comment"> *  Please killall solar_monitor before running this sample code.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#ifdef __ECOS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;commands.h&gt;</span></div>
<div class="line">shell_old_cmd( <span class="stringliteral">&quot;rtp&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, user_rtp_main );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">void</span> codec_change(<span class="keywordtype">int</span> chid, uint32 local_ip, uint32 remote_ip, uint16 local_port, uint16 remote_port, </div>
<div class="line">    <span class="keywordtype">int</span> tx_codec, <span class="keywordtype">int</span> rx_codec, <span class="keywordtype">int</span> tx_frame_no)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ActiveSession;</div>
<div class="line">    <a name="_a0"></a><a class="code" href="structrtp__config__t.html" title="Structure for RTP handling  ">rtp_config_t</a> rtp_config;</div>
<div class="line">    <a name="_a1"></a><a class="code" href="structrtcp__config__t.html" title="Structure for RTCP connection.">rtcp_config_t</a> rtcp_config;</div>
<div class="line">    <a name="_a2"></a><a class="code" href="structpayloadtype__config__t.html" title="Structure for RTP payload type  ">payloadtype_config_t</a> codec_config;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// close rtp</span></div>
<div class="line">    <a name="a3"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, 0, <a name="a4"></a><a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa0f1821892441a90141e10d5e947e912e" title="RTP Session- Inactive.">rtp_session_inactive</a>);</div>
<div class="line">    <span class="comment">//rtk_SetRtpSessionState(chid, 1, rtp_session_inactive);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// call rtk_Offhook_Action at last</span></div>
<div class="line">    <span class="comment">//rtk_OnHookAction(chid);</span></div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    <span class="comment">// call rtk_Offhook_Action at first</span></div>
<div class="line">    <span class="comment">//rtk_OffHookAction(chid);</span></div>
<div class="line">    ActiveSession = 0;</div>
<div class="line">    <span class="comment">//rtk_SetTranSessionID(chid, ActiveSession);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// set RTP session</span></div>
<div class="line">    memset(&amp;rtp_config, 0, <span class="keyword">sizeof</span>(rtp_config));</div>
<div class="line">    rtp_config.<a name="a5"></a><a class="code" href="structrtp__config__t.html#a6835ba1d83a5bcc4bd0af7d83076ea6a" title="channel id">chid</a>             = chid;         <span class="comment">// use channel </span></div>
<div class="line">    rtp_config.<a name="a6"></a><a class="code" href="structrtp__config__t.html#ae30a7620430762b93c1792477cb0eaeb" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>              = ActiveSession;</div>
<div class="line">    rtp_config.<a name="a7"></a><a class="code" href="structrtp__config__t.html#a1630c48e70b3818c1b46fa3d2ee0a8ef" title="Not support yet. tcp = 1 or udp = 0.">isTcp</a>            = 0;            <span class="comment">// use udp</span></div>
<div class="line">    rtp_config.<a name="a8"></a><a class="code" href="structrtp__config__t.html#ab99c37801711581655f5833a38f70044" title="local IP address for RTP">extIp</a>            = local_ip;</div>
<div class="line">    rtp_config.<a name="a9"></a><a class="code" href="structrtp__config__t.html#a959b92e3bb71c4d081f1dd7975906d9f" title="remote IP address for RTP">remIp</a>            = remote_ip;</div>
<div class="line">    rtp_config.<a name="a10"></a><a class="code" href="structrtp__config__t.html#ae95db080a339d14e8c5860a689d55e35" title="local RTP port number">extPort</a>          = local_port;</div>
<div class="line">    rtp_config.<a name="a11"></a><a class="code" href="structrtp__config__t.html#a427f96d3294a74896580c54c2fa8a171" title="remote RTP port number">remPort</a>          = remote_port;</div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_VOICE_QOS</span></div>
<div class="line"><span class="preprocessor"></span>    rtp_config.tos              = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#ifdef SUPPORT_RFC2833</span></div>
<div class="line"><span class="preprocessor"></span>    rtp_config.<a name="a12"></a><a class="code" href="structrtp__config__t.html#a217fe384b06c22665689c5c558ed795d" title="local rfc2833 payload type  rfc2833_payload_type_locale MUST be set from application to DSP...">rfc2833_payload_type_local</a>   = 96;</div>
<div class="line">    rtp_config.<a name="a13"></a><a class="code" href="structrtp__config__t.html#aa50cbeaa509c7554e85fe2c125ed6cca" title="remote rfc2833 payload type  rfc2833_payload_type_remote MUST be set from application to DSP...">rfc2833_payload_type_remote</a>  = 96;</div>
<div class="line">    rtp_config.<a name="a14"></a><a class="code" href="structrtp__config__t.html#ad5526fa524c914af80c5ab112b850536" title="local Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_local</a>   = 101;</div>
<div class="line">    rtp_config.<a name="a15"></a><a class="code" href="structrtp__config__t.html#a65be43b15030c9d62a09e47e5c670841" title="remote Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_remote</a>  = 101;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    rtp_config.<a class="code" href="structrtp__config__t.html#a217fe384b06c22665689c5c558ed795d" title="local rfc2833 payload type  rfc2833_payload_type_locale MUST be set from application to DSP...">rfc2833_payload_type_local</a>   = 0;</div>
<div class="line">    rtp_config.<a class="code" href="structrtp__config__t.html#aa50cbeaa509c7554e85fe2c125ed6cca" title="remote rfc2833 payload type  rfc2833_payload_type_remote MUST be set from application to DSP...">rfc2833_payload_type_remote</a>  = 0;</div>
<div class="line">    rtp_config.<a class="code" href="structrtp__config__t.html#ad5526fa524c914af80c5ab112b850536" title="local Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_local</a>   = 0;</div>
<div class="line">    rtp_config.<a class="code" href="structrtp__config__t.html#a65be43b15030c9d62a09e47e5c670841" title="remote Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_remote</a>  = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#if defined (SUPPORT_RTP_REDUNDANT_APP)</span></div>
<div class="line"><span class="preprocessor"></span>    rtp_config.<a name="a16"></a><a class="code" href="structrtp__config__t.html#abacf7214ccfa686dde4da5c47797fb7f" title="Payload type of local redundant rtp. 0 means disable rtp redundant.">rtp_redundant_payload_type_local</a>     = 0;</div>
<div class="line">    rtp_config.<a name="a17"></a><a class="code" href="structrtp__config__t.html#a584d18c8335c56d12c61a324af24eab8" title="Payload type of remote redundant rtp 0 means disable rtp redundant.">rtp_redundant_payload_type_remote</a>    = 0;</div>
<div class="line">    rtp_config.<a name="a18"></a><a class="code" href="structrtp__config__t.html#aefa61ecebb4c33ad03b235b7d8282e56" title="Maximum RTP redundancy number in TX direction (0~2). 0 means no RTP redundancy.">rtp_redundant_max_Audio</a>      = 0;</div>
<div class="line">    rtp_config.<a name="a19"></a><a class="code" href="structrtp__config__t.html#a5649f8db4f869bb73fc3d9337ba7cb98" title="Maximum RFC 2833 redundancy number in TX direction (0~5). 0 means no RFC 2833 redundancy.">rtp_redundant_max_RFC2833</a>        = 0;</div>
<div class="line"><span class="preprocessor">#elif defined (SUPPORT_RTP_REDUNDANT)</span></div>
<div class="line"><span class="preprocessor"></span>    rtp_config.<a class="code" href="structrtp__config__t.html#abacf7214ccfa686dde4da5c47797fb7f" title="Payload type of local redundant rtp. 0 means disable rtp redundant.">rtp_redundant_payload_type_local</a>     = 0;</div>
<div class="line">    rtp_config.<a class="code" href="structrtp__config__t.html#a584d18c8335c56d12c61a324af24eab8" title="Payload type of remote redundant rtp 0 means disable rtp redundant.">rtp_redundant_payload_type_remote</a>    = 0;</div>
<div class="line">    rtp_config.<a class="code" href="structrtp__config__t.html#aefa61ecebb4c33ad03b235b7d8282e56" title="Maximum RTP redundancy number in TX direction (0~2). 0 means no RTP redundancy.">rtp_redundant_max_Audio</a>      = 0;</div>
<div class="line">    rtp_config.<a class="code" href="structrtp__config__t.html#a5649f8db4f869bb73fc3d9337ba7cb98" title="Maximum RFC 2833 redundancy number in TX direction (0~5). 0 means no RFC 2833 redundancy.">rtp_redundant_max_RFC2833</a>        = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    rtp_config.<a name="a20"></a><a class="code" href="structrtp__config__t.html#ae539171a25479d0ef291c01aea8741c8" title="Payload type of local SID (Silence Insertion Description). 13 is recommend.">SID_payload_type_local</a>   = 0;</div>
<div class="line">    rtp_config.<a name="a21"></a><a class="code" href="structrtp__config__t.html#a251fe201cd44524df63f076a8756ad71" title="Payload type of remote SID (Silence Insertion Description). 13 is recommend.">SID_payload_type_remote</a>  = 0;</div>
<div class="line">    rtp_config.<a name="a22"></a><a class="code" href="structrtp__config__t.html#a864753145110bf95e0a4b86ad32a2dcc" title="initialize seqno, SSRC and timestamp randomly, so ignore below parameters">init_randomly</a>        = 1;</div>
<div class="line">    rtp_config.<a name="a23"></a><a class="code" href="structrtp__config__t.html#ab2fdc41617ee0e672181577c00944219" title="initial seqno">init_seqno</a>           = 0;</div>
<div class="line">    rtp_config.<a name="a24"></a><a class="code" href="structrtp__config__t.html#abf984d1afc9ee6616d163d1ecc04b28d" title="initial SSRC">init_SSRC</a>            = 0;</div>
<div class="line">    rtp_config.<a name="a25"></a><a class="code" href="structrtp__config__t.html#a70cd97dacde76a2364592cc3db18a0be" title="initial timestamp">init_timestamp</a>       = 0;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_RTK_VOIP_IPV6_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>    rtp_config.ipv6                 = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <a name="a26"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#ga20fe6f6be15faef8c57328ab22f95393" title="Set RTP configuration.">rtk_SetRtpConfig</a>(&amp;rtp_config);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set RTCP session</span></div>
<div class="line">    rtcp_config.<a name="a27"></a><a class="code" href="structrtcp__config__t.html#a4eee8d3ffeae02c3c9e853d511662a6e" title="channel id">chid</a>            = rtp_config.<a class="code" href="structrtp__config__t.html#a6835ba1d83a5bcc4bd0af7d83076ea6a" title="channel id">chid</a>;</div>
<div class="line">    rtcp_config.<a name="a28"></a><a class="code" href="structrtcp__config__t.html#ab32452b9570fc9c7192345fcdc30e856" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>             = rtp_config.<a class="code" href="structrtp__config__t.html#ae30a7620430762b93c1792477cb0eaeb" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>;</div>
<div class="line">    rtcp_config.<a name="a29"></a><a class="code" href="structrtcp__config__t.html#a3f073f1023510bc136f6112391f036c9" title="remote IP address for RTP">remIp</a>           = rtp_config.<a class="code" href="structrtp__config__t.html#a959b92e3bb71c4d081f1dd7975906d9f" title="remote IP address for RTP">remIp</a>;</div>
<div class="line">    rtcp_config.<a name="a30"></a><a class="code" href="structrtcp__config__t.html#a70283937a7d65f2ac10966c6f66eadca" title="remote RTP port number">remPort</a>         = rtp_config.<a class="code" href="structrtp__config__t.html#a427f96d3294a74896580c54c2fa8a171" title="remote RTP port number">remPort</a> + 1;</div>
<div class="line">    rtcp_config.<a name="a31"></a><a class="code" href="structrtcp__config__t.html#af3e47243832954d9d5280f968c1f5903" title="local IP address for RTP">extIp</a>           = rtp_config.<a class="code" href="structrtp__config__t.html#ab99c37801711581655f5833a38f70044" title="local IP address for RTP">extIp</a>;</div>
<div class="line">    rtcp_config.<a name="a32"></a><a class="code" href="structrtcp__config__t.html#acf221362317ac18312f9995f2f300ccd" title="local RTP port number">extPort</a>         = rtp_config.<a class="code" href="structrtp__config__t.html#ae95db080a339d14e8c5860a689d55e35" title="local RTP port number">extPort</a> + 1;</div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_VOICE_QOS</span></div>
<div class="line"><span class="preprocessor"></span>    rtcp_config.tos             = rtp_config.tos;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    rtcp_config.<a name="a33"></a><a class="code" href="structrtcp__config__t.html#acd793a52eec8db38a423f967da4d377c" title="RTCP TX interval (ms)">txInterval</a>      = 500;      <span class="comment">// send rtcp every 500ms</span></div>
<div class="line">    rtcp_config.<a name="a34"></a><a class="code" href="structrtcp__config__t.html#a0ffa55cca1dee9428846effbccb6e27b" title="enable RTCP XR support (RTCP only)">enableXR</a>        = 1;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_RTK_VOIP_IPV6_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>    rtcp_config.ipv6            = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <a name="a35"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#ga58c5e4de4dea0b81c2dca7ec589c59f4" title="Set RTCP configuration.">rtk_SetRtcpConfig</a>(&amp;rtcp_config);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// set rtp payload, and other session parameters.</span></div>
<div class="line">    codec_config.<a name="a36"></a><a class="code" href="structpayloadtype__config__t.html#a7a81ef5b12c7b2c492e2f466402b3fba" title="channel id">chid</a>           = chid;</div>
<div class="line">    codec_config.<a name="a37"></a><a class="code" href="structpayloadtype__config__t.html#a717481154070dc5fe2399c656c661ace" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>            = ActiveSession;</div>
<div class="line">    <span class="keywordflow">if</span> ((tx_codec&gt;=77) &amp;&amp; (tx_codec&lt;=85)) <span class="comment">//AMR-WB packet format</span></div>
<div class="line">        codec_config.<a name="a38"></a><a class="code" href="structpayloadtype__config__t.html#af983fd7e21d7a15b3e01dd835a070261" title="Payload type of local voice codec.">local_pt</a>   = 117;  <span class="comment">// Hard code AMR-WB payload type</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        codec_config.<a class="code" href="structpayloadtype__config__t.html#af983fd7e21d7a15b3e01dd835a070261" title="Payload type of local voice codec.">local_pt</a>   = tx_codec; <span class="comment">// G729 use static pt 18</span></div>
<div class="line">    <span class="keywordflow">if</span> ((rx_codec&gt;=77) &amp;&amp; (rx_codec&lt;=85)) <span class="comment">//AMR-WB packet format</span></div>
<div class="line">        codec_config.<a name="a39"></a><a class="code" href="structpayloadtype__config__t.html#a715fb4beb036ad7703243258c88e4c9a" title="Payload type of remote voice codec.">remote_pt</a>  = 117;  <span class="comment">// Hard code AMR-WB payload type</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        codec_config.<a class="code" href="structpayloadtype__config__t.html#a715fb4beb036ad7703243258c88e4c9a" title="Payload type of remote voice codec.">remote_pt</a>  = rx_codec; <span class="comment">// G729 use static pt 18</span></div>
<div class="line">    codec_config.<a name="a40"></a><a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a>        = tx_codec;</div>
<div class="line">    codec_config.<a name="a41"></a><a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a>       = rx_codec;</div>
<div class="line">    codec_config.<a name="a42"></a><a class="code" href="structpayloadtype__config__t.html#aac8c4492c426f10e4ee22ce5838c801b" title="Payload type of local voice band data (vbd).">local_pt_vbd</a>       = rtpPayloadUndefined;</div>
<div class="line">    codec_config.<a name="a43"></a><a class="code" href="structpayloadtype__config__t.html#a45b5dd95db0de40fe811c2c890fc716d" title="Payload type in remote voice band data (vbd).">remote_pt_vbd</a>      = rtpPayloadUndefined;</div>
<div class="line">    codec_config.<a name="a44"></a><a class="code" href="structpayloadtype__config__t.html#ada6bbf4c14e274e6adc90ac51a38494c" title="Codec type of voice band data (vbd). Usually used by V.152 FAX.">uPktFormat_vbd</a>         = rtpPayloadUndefined;</div>
<div class="line">    codec_config.<a name="a45"></a><a class="code" href="structpayloadtype__config__t.html#a51db5ebb75d4929816d0aa4967d2bc49" title="G.723.1 rate. There are two bit rates at which G.723.1 can operate.  Valid values are:  0: 6...">nG723Type</a>          = 0;</div>
<div class="line">    codec_config.<a name="a46"></a><a class="code" href="structpayloadtype__config__t.html#a921c890c8d1f7ae8b8cc0cabf27bf778" title="Frame per packet of local (Tx) voice codec.">nLocalFramePerPacket</a>   = tx_frame_no;</div>
<div class="line">    codec_config.<a name="a47"></a><a class="code" href="structpayloadtype__config__t.html#a5ec2b162f986c6016bf17dddd98c93d3" title="Frame per packet of remote (Rx) voice codec.">nRemoteFramePerPacket</a>  = 1;</div>
<div class="line">    codec_config.<a name="a48"></a><a class="code" href="structpayloadtype__config__t.html#a0760774c59b4302c41a13c3f20ee971e" title="Frame per packet of voice codec (vbd)">nFramePerPacket_vbd</a> = 1;</div>
<div class="line">    codec_config.<a name="a49"></a><a class="code" href="structpayloadtype__config__t.html#aba143d7f2f2e9130cc729056b3668e66" title="Enable/Disable VAD (Voice activity detection)  Valid values are: 0: Disable 1: Enable.">bVAD</a>           = 0;</div>
<div class="line">    codec_config.<a name="a50"></a><a class="code" href="structpayloadtype__config__t.html#ae31dc1e199838d927b4ff751e4dc4d5a" title="Enable/Disable PLC (Packet Loss Concealment)  Valid values are: 0: Disable 1: Enable.">bPLC</a>           = 1;</div>
<div class="line">    codec_config.<a name="a51"></a><a class="code" href="structpayloadtype__config__t.html#a5edd303e38c49d0870ae64c0682b0bd1" title="minimun jitter delay (10ms)  nJitterDelay is the minimum delay of jitter buffer.  Valid values are 4 ...">nJitterDelay</a>       = 4;</div>
<div class="line">    codec_config.<a name="a52"></a><a class="code" href="structpayloadtype__config__t.html#a1cf71efa5a26840869adc9ce70812506" title="maximum jitter delay (10ms)  nJitterDelay is the maximum delay of jitter buffer.  Valid values are 13...">nMaxDelay</a>          = 13;</div>
<div class="line">    codec_config.<a name="a53"></a><a class="code" href="structpayloadtype__config__t.html#a2994da36a394d9edf2ff126817181e48" title="maximum strict jitter delay (10ms)  nMaxStrictDelay is the maximum strict delay of jitter buffer...">nMaxStrictDelay</a>    = 10000;</div>
<div class="line">    codec_config.<a name="a54"></a><a class="code" href="structpayloadtype__config__t.html#a2435652e35b35df20454edaeca7942d0" title="optimzation factor of jitter buffer  The optimization factor is the value for adjusting the quality o...">nJitterFactor</a>      = 7;</div>
<div class="line">    codec_config.<a name="a55"></a><a class="code" href="structpayloadtype__config__t.html#a671c4ba30e9bb37f85ea34c722c769d1" title="G726 packing order  Valid values are:  0: Packing none 1: Packing left 2: Packing right...">nG726Packing</a>       = 2;        <span class="comment">//pack right</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((codec_config.<a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a> == rtpPayloadG722) ||</div>
<div class="line">        (codec_config.<a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a> == rtpPayloadG722) )</div>
<div class="line">        codec_config.<a name="a56"></a><a class="code" href="structpayloadtype__config__t.html#ad82d877ec1c901972f53d166a936c27f" title="PCM Mode Setting  Valid values are:  0: No action (use previous PCM enable mode)  1: Auto mode (DSP w...">nPcmMode</a>       = 3;        <span class="comment">// wide-band</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        codec_config.<a class="code" href="structpayloadtype__config__t.html#ad82d877ec1c901972f53d166a936c27f" title="PCM Mode Setting  Valid values are:  0: No action (use previous PCM enable mode)  1: Auto mode (DSP w...">nPcmMode</a>       = 2;        <span class="comment">// narrow-band</span></div>
<div class="line"></div>
<div class="line">    <a name="a57"></a><a class="code" href="group__TAPI__DSP__MEDIA.html#ga66c7ebfb55ed123876274a6f61ee6ded" title="Set RTP payload type.">rtk_SetRtpPayloadType</a>(&amp;codec_config);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// start rtp (channel number = 0, session number = 0)</span></div>
<div class="line">    <a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, ActiveSession, <a name="a58"></a><a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa594fa9c4862d7d3d0dba9d0f4e231eea" title="RTP Session- Send/Recv.">rtp_session_sendrecv</a>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;codec_change (codec tx:%d, rx:%d), (frame_no: tx:%d)\n&quot;</span>, </div>
<div class="line">        tx_codec,rx_codec, tx_frame_no);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef __ECOS</span></div>
<div class="line"><span class="preprocessor"></span>CMD_DECL( user_rtp_main )</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>{</div>
<div class="line">    <a class="code" href="voip__manager_8h.html#ac3d830d3c2e104857c0628ae98e456f8">SIGNSTATE</a> val;</div>
<div class="line">    <a class="code" href="structrtp__config__t.html" title="Structure for RTP handling  ">rtp_config_t</a> rtp_config;</div>
<div class="line">    <a class="code" href="structrtcp__config__t.html" title="Structure for RTCP connection.">rtcp_config_t</a> rtcp_config;</div>
<div class="line">    <a class="code" href="structpayloadtype__config__t.html" title="Structure for RTP payload type  ">payloadtype_config_t</a> codec_config;</div>
<div class="line">    <span class="keywordtype">int</span> ActiveSession;</div>
<div class="line">    <span class="keywordtype">int</span> bStartRTP;</div>
<div class="line">    <span class="keywordtype">int</span> dtmf_val[SIGN_HASH + 1] = {0,1,2,3,4,5,6,7,8,9,0,10,11};</div>
<div class="line">    <span class="keywordtype">int</span> chid = 0;</div>
<div class="line">    <span class="keywordtype">int</span> tx_codec=0;</div>
<div class="line">    <span class="keywordtype">int</span> rx_codec=0;</div>
<div class="line">    <span class="keywordtype">int</span> tx_frame_no=1;</div>
<div class="line">    <span class="keywordtype">int</span> mid;</div>
<div class="line">    <a class="code" href="voip__params_8h.html#adc20e233fff4ea8af423ffe7a8a1029d">VoipEventID</a> dsp_ent;</div>
<div class="line">    uint32 dsp_data;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argc != 9)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;usage: %s chid src_ip dest_ip src_port dest_port tx_codec rx_codec tx_frame_no\n&quot;</span>, argv[0]);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    tx_codec = atoi(argv[6]);</div>
<div class="line">    rx_codec = atoi(argv[7]);</div>
<div class="line">    tx_frame_no = atoi(argv[8]);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// init channel</span></div>
<div class="line">    chid = atoi(argv[1]);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// init dsp</span></div>
<div class="line">    <a name="a59"></a><a class="code" href="group__TAPI__DSP__INIT.html#ga4b32be720cdd238fb82cf0bad3db2114" title="Interface Initialization.">rtk_InitDsp</a>(chid);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_RFC2833</span></div>
<div class="line"><span class="preprocessor"></span>    <a name="a60"></a><a class="code" href="group__TAPI__DSP__CID__DTMF.html#gab8245d14b7a7a684e1aa25e1188c137b" title="Set the DTMF mode.">rtk_SetDtmfMode</a>(chid, DTMF_RFC2833);    <span class="comment">// set dtmf mode</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="group__TAPI__DSP__CID__DTMF.html#gab8245d14b7a7a684e1aa25e1188c137b" title="Set the DTMF mode.">rtk_SetDtmfMode</a>(chid, DTMF_INBAND); <span class="comment">// set dtmf mode</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="comment">// init flag</span></div>
<div class="line">    bStartRTP = 0;</div>
<div class="line">    ActiveSession = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (mid=0; mid &lt;2; mid++)</div>
<div class="line">        {</div>
<div class="line">            <a name="a61"></a><a class="code" href="group__TAPI__PHONE__EVENT.html#ga136a4269e357f7616419d456578f14c2" title="Retrieve DSP Event, such as tone end event, caller ID end event.">rtk_GetDspEvent</a>(chid, mid, &amp;dsp_ent, &amp;dsp_data);</div>
<div class="line">            <span class="keywordflow">if</span> (dsp_ent == <a name="a62"></a><a class="code" href="voip__params_8h.html#adc20e233fff4ea8af423ffe7a8a1029daa6c9d66219964f1f4245d0526d5a729d" title="Unexpect RTP payload type from remote.">VEID_DSP_RTP_PAYLOAD_MISMATCH</a>)</div>
<div class="line">                printf(<span class="stringliteral">&quot;Get PT mis-matched event, ch%d, mid%d, PT=%d\n&quot;</span>, chid, mid, dsp_data);</div>
<div class="line">        }</div>
<div class="line">        <a name="a63"></a><a class="code" href="group__TAPI__OBSOLETE__GROUP.html#ga09c56bc79918bd82b057736c05905fde" title="Get the FXS state.">rtk_GetFxsEvent</a>(chid, &amp;val);</div>
<div class="line">        <span class="keywordflow">switch</span> (val)</div>
<div class="line">        {</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY1:</div>
<div class="line">            <span class="comment">// Change TX to G.711a</span></div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayloadPCMA, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY2:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to G.722</span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayloadG722, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY3:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to G.723</span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayloadG723, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY4:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to GSM-FR</span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayloadGSM, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY5:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to </span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayloadPCMU, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY6:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to G.726-32k</span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayloadG726_32, tx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY7:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to iLBC 30ms</span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayload_iLBC, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY8:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to iLBC 20ms</span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayload_iLBC_20ms, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY9:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to G.729</span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayloadG729, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY0:</div>
<div class="line">            <span class="keywordflow">if</span> (chid ==0 )</div>
<div class="line">            <span class="comment">// Change TX to G.711u</span></div>
<div class="line">            codec_change(chid, inet_addr(argv[2]), inet_addr(argv[3]), </div>
<div class="line">                htons(atoi(argv[4])), htons(atoi(argv[5])), rtpPayloadPCMU, rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_STAR:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_HASH:</div>
<div class="line">            <span class="keywordflow">if</span> (bStartRTP &amp;&amp; ActiveSession == 0)</div>
<div class="line">                <a name="a64"></a><a class="code" href="group__TAPI__MEDIA__RFC2833.html#ga73a83fa0a1b6d81f5324f1ade559e0ab" title="Send DTMF via RFC2833.">rtk_SetRtpRfc2833</a>(chid, 0, dtmf_val[val], 100);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> SIGN_OFFHOOK:</div>
<div class="line">            <span class="comment">// call rtk_OffHookAction at first</span></div>
<div class="line">            <a name="a65"></a><a class="code" href="group__TAPI__PHONE__MISC.html#gad0fba4da59d7db9bb24f88ca30c2ad34" title="OffHook Action function. Call this TAPI always when Off-Hook event is got.">rtk_OffHookAction</a>(chid);</div>
<div class="line">            ActiveSession = 0;</div>
<div class="line">            <a name="a66"></a><a class="code" href="group__TAPI__MEDIA__MISC.html#gaed19a0479f028247263e839f224c7f56" title="Assign the active session.">rtk_SetTranSessionID</a>(chid, ActiveSession);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// set RTP session</span></div>
<div class="line">            memset(&amp;rtp_config, 0, <span class="keyword">sizeof</span>(rtp_config));</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a6835ba1d83a5bcc4bd0af7d83076ea6a" title="channel id">chid</a>             = chid;                 <span class="comment">// use channel </span></div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#ae30a7620430762b93c1792477cb0eaeb" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>              = ActiveSession;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a1630c48e70b3818c1b46fa3d2ee0a8ef" title="Not support yet. tcp = 1 or udp = 0.">isTcp</a>            = 0;                    <span class="comment">// use udp</span></div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#ab99c37801711581655f5833a38f70044" title="local IP address for RTP">extIp</a>            = inet_addr(argv[2]);</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a959b92e3bb71c4d081f1dd7975906d9f" title="remote IP address for RTP">remIp</a>            = inet_addr(argv[3]);</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#ae95db080a339d14e8c5860a689d55e35" title="local RTP port number">extPort</a>          = htons(atoi(argv[4]));</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a427f96d3294a74896580c54c2fa8a171" title="remote RTP port number">remPort</a>          = htons(atoi(argv[5]));</div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_VOICE_QOS</span></div>
<div class="line"><span class="preprocessor"></span>            rtp_config.tos              = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_RFC2833</span></div>
<div class="line"><span class="preprocessor"></span>            rtp_config.<a class="code" href="structrtp__config__t.html#a217fe384b06c22665689c5c558ed795d" title="local rfc2833 payload type  rfc2833_payload_type_locale MUST be set from application to DSP...">rfc2833_payload_type_local</a>  = 96;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#aa50cbeaa509c7554e85fe2c125ed6cca" title="remote rfc2833 payload type  rfc2833_payload_type_remote MUST be set from application to DSP...">rfc2833_payload_type_remote</a> = 96;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#ad5526fa524c914af80c5ab112b850536" title="local Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_local</a> = 101;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a65be43b15030c9d62a09e47e5c670841" title="remote Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_remote</a> = 101;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>            rtp_config.<a class="code" href="structrtp__config__t.html#a217fe384b06c22665689c5c558ed795d" title="local rfc2833 payload type  rfc2833_payload_type_locale MUST be set from application to DSP...">rfc2833_payload_type_local</a>  = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#aa50cbeaa509c7554e85fe2c125ed6cca" title="remote rfc2833 payload type  rfc2833_payload_type_remote MUST be set from application to DSP...">rfc2833_payload_type_remote</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#ad5526fa524c914af80c5ab112b850536" title="local Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_local</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a65be43b15030c9d62a09e47e5c670841" title="remote Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_remote</a> = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#if defined(SUPPORT_RTP_REDUNDANT_APP)</span></div>
<div class="line"><span class="preprocessor"></span>            rtp_config.<a class="code" href="structrtp__config__t.html#abacf7214ccfa686dde4da5c47797fb7f" title="Payload type of local redundant rtp. 0 means disable rtp redundant.">rtp_redundant_payload_type_local</a>  = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a584d18c8335c56d12c61a324af24eab8" title="Payload type of remote redundant rtp 0 means disable rtp redundant.">rtp_redundant_payload_type_remote</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#aefa61ecebb4c33ad03b235b7d8282e56" title="Maximum RTP redundancy number in TX direction (0~2). 0 means no RTP redundancy.">rtp_redundant_max_Audio</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a5649f8db4f869bb73fc3d9337ba7cb98" title="Maximum RFC 2833 redundancy number in TX direction (0~5). 0 means no RFC 2833 redundancy.">rtp_redundant_max_RFC2833</a> = 0;</div>
<div class="line"><span class="preprocessor">#elif defined(SUPPORT_RTP_REDUNDANT)</span></div>
<div class="line"><span class="preprocessor"></span>            rtp_config.<a class="code" href="structrtp__config__t.html#abacf7214ccfa686dde4da5c47797fb7f" title="Payload type of local redundant rtp. 0 means disable rtp redundant.">rtp_redundant_payload_type_local</a>  = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a584d18c8335c56d12c61a324af24eab8" title="Payload type of remote redundant rtp 0 means disable rtp redundant.">rtp_redundant_payload_type_remote</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#aefa61ecebb4c33ad03b235b7d8282e56" title="Maximum RTP redundancy number in TX direction (0~2). 0 means no RTP redundancy.">rtp_redundant_max_Audio</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a5649f8db4f869bb73fc3d9337ba7cb98" title="Maximum RFC 2833 redundancy number in TX direction (0~5). 0 means no RFC 2833 redundancy.">rtp_redundant_max_RFC2833</a> = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>            rtp_config.<a class="code" href="structrtp__config__t.html#ae539171a25479d0ef291c01aea8741c8" title="Payload type of local SID (Silence Insertion Description). 13 is recommend.">SID_payload_type_local</a>  = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a251fe201cd44524df63f076a8756ad71" title="Payload type of remote SID (Silence Insertion Description). 13 is recommend.">SID_payload_type_remote</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a864753145110bf95e0a4b86ad32a2dcc" title="initialize seqno, SSRC and timestamp randomly, so ignore below parameters">init_randomly</a> = 1;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#ab2fdc41617ee0e672181577c00944219" title="initial seqno">init_seqno</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#abf984d1afc9ee6616d163d1ecc04b28d" title="initial SSRC">init_SSRC</a> = 0;</div>
<div class="line">            rtp_config.<a class="code" href="structrtp__config__t.html#a70cd97dacde76a2364592cc3db18a0be" title="initial timestamp">init_timestamp</a> = 0;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_RTK_VOIP_IPV6_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>            rtp_config.ipv6         = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>            <a class="code" href="group__TAPI__MEDIA__RTP.html#ga20fe6f6be15faef8c57328ab22f95393" title="Set RTP configuration.">rtk_SetRtpConfig</a>(&amp;rtp_config);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// set RTCP session</span></div>
<div class="line">            rtcp_config.<a class="code" href="structrtcp__config__t.html#a4eee8d3ffeae02c3c9e853d511662a6e" title="channel id">chid</a>    = rtp_config.<a class="code" href="structrtp__config__t.html#a6835ba1d83a5bcc4bd0af7d83076ea6a" title="channel id">chid</a>;</div>
<div class="line">            rtcp_config.<a class="code" href="structrtcp__config__t.html#ab32452b9570fc9c7192345fcdc30e856" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>     = rtp_config.<a class="code" href="structrtp__config__t.html#ae30a7620430762b93c1792477cb0eaeb" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>;</div>
<div class="line">            rtcp_config.<a class="code" href="structrtcp__config__t.html#a3f073f1023510bc136f6112391f036c9" title="remote IP address for RTP">remIp</a>   = rtp_config.<a class="code" href="structrtp__config__t.html#a959b92e3bb71c4d081f1dd7975906d9f" title="remote IP address for RTP">remIp</a>;</div>
<div class="line">            rtcp_config.<a class="code" href="structrtcp__config__t.html#a70283937a7d65f2ac10966c6f66eadca" title="remote RTP port number">remPort</a> = rtp_config.<a class="code" href="structrtp__config__t.html#a427f96d3294a74896580c54c2fa8a171" title="remote RTP port number">remPort</a> + 1;</div>
<div class="line">            rtcp_config.<a class="code" href="structrtcp__config__t.html#af3e47243832954d9d5280f968c1f5903" title="local IP address for RTP">extIp</a>   = rtp_config.<a class="code" href="structrtp__config__t.html#ab99c37801711581655f5833a38f70044" title="local IP address for RTP">extIp</a>;</div>
<div class="line">            rtcp_config.<a class="code" href="structrtcp__config__t.html#acf221362317ac18312f9995f2f300ccd" title="local RTP port number">extPort</a> = rtp_config.<a class="code" href="structrtp__config__t.html#ae95db080a339d14e8c5860a689d55e35" title="local RTP port number">extPort</a> + 1;</div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_VOICE_QOS</span></div>
<div class="line"><span class="preprocessor"></span>            rtcp_config.tos     = rtp_config.tos;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>            </div>
<div class="line">            rtcp_config.<a class="code" href="structrtcp__config__t.html#acd793a52eec8db38a423f967da4d377c" title="RTCP TX interval (ms)">txInterval</a> = 500;   <span class="comment">// send rtcp every 500ms</span></div>
<div class="line">            rtcp_config.<a class="code" href="structrtcp__config__t.html#a0ffa55cca1dee9428846effbccb6e27b" title="enable RTCP XR support (RTCP only)">enableXR</a> = 1;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_RTK_VOIP_IPV6_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>            rtcp_config.ipv6    = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>            <a class="code" href="group__TAPI__MEDIA__RTP.html#ga58c5e4de4dea0b81c2dca7ec589c59f4" title="Set RTCP configuration.">rtk_SetRtcpConfig</a>(&amp;rtcp_config);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            <span class="comment">// set rtp payload, and other session parameters.</span></div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a7a81ef5b12c7b2c492e2f466402b3fba" title="channel id">chid</a>               = chid;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a717481154070dc5fe2399c656c661ace" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>                = ActiveSession;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ((tx_codec&gt;=77) &amp;&amp; (tx_codec&lt;=85)) <span class="comment">//AMR-WB packet format</span></div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#af983fd7e21d7a15b3e01dd835a070261" title="Payload type of local voice codec.">local_pt</a>       = 117; <span class="comment">//Hard code AMR-WB payload type to 117</span></div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#af983fd7e21d7a15b3e01dd835a070261" title="Payload type of local voice codec.">local_pt</a>       = tx_codec;                 <span class="comment">// G729 use static pt 18</span></div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> ((rx_codec&gt;=77) &amp;&amp; (rx_codec&lt;=85)) <span class="comment">//AMR-WB packet format</span></div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#a715fb4beb036ad7703243258c88e4c9a" title="Payload type of remote voice codec.">remote_pt</a>      = 117; <span class="comment">//Hard code AMR-WB payload type to 117</span></div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#a715fb4beb036ad7703243258c88e4c9a" title="Payload type of remote voice codec.">remote_pt</a>      = rx_codec;                 <span class="comment">// G729 use static pt 18</span></div>
<div class="line"></div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a>    = tx_codec;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a>   = rx_codec;</div>
<div class="line"></div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#aac8c4492c426f10e4ee22ce5838c801b" title="Payload type of local voice band data (vbd).">local_pt_vbd</a>       = rtpPayloadUndefined;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a45b5dd95db0de40fe811c2c890fc716d" title="Payload type in remote voice band data (vbd).">remote_pt_vbd</a>      = rtpPayloadUndefined;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#ada6bbf4c14e274e6adc90ac51a38494c" title="Codec type of voice band data (vbd). Usually used by V.152 FAX.">uPktFormat_vbd</a>     = rtpPayloadUndefined;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a51db5ebb75d4929816d0aa4967d2bc49" title="G.723.1 rate. There are two bit rates at which G.723.1 can operate.  Valid values are:  0: 6...">nG723Type</a>          = 0;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a921c890c8d1f7ae8b8cc0cabf27bf778" title="Frame per packet of local (Tx) voice codec.">nLocalFramePerPacket</a>   = tx_frame_no;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a5ec2b162f986c6016bf17dddd98c93d3" title="Frame per packet of remote (Rx) voice codec.">nRemoteFramePerPacket</a>  = 1;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a0760774c59b4302c41a13c3f20ee971e" title="Frame per packet of voice codec (vbd)">nFramePerPacket_vbd</a> = 1;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#aba143d7f2f2e9130cc729056b3668e66" title="Enable/Disable VAD (Voice activity detection)  Valid values are: 0: Disable 1: Enable.">bVAD</a>               = 0;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#ae31dc1e199838d927b4ff751e4dc4d5a" title="Enable/Disable PLC (Packet Loss Concealment)  Valid values are: 0: Disable 1: Enable.">bPLC</a>               = 1;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a5edd303e38c49d0870ae64c0682b0bd1" title="minimun jitter delay (10ms)  nJitterDelay is the minimum delay of jitter buffer.  Valid values are 4 ...">nJitterDelay</a>       = 4;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a1cf71efa5a26840869adc9ce70812506" title="maximum jitter delay (10ms)  nJitterDelay is the maximum delay of jitter buffer.  Valid values are 13...">nMaxDelay</a>          = 13;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a2994da36a394d9edf2ff126817181e48" title="maximum strict jitter delay (10ms)  nMaxStrictDelay is the maximum strict delay of jitter buffer...">nMaxStrictDelay</a>    = 10000;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a2435652e35b35df20454edaeca7942d0" title="optimzation factor of jitter buffer  The optimization factor is the value for adjusting the quality o...">nJitterFactor</a>      = 7;</div>
<div class="line">            codec_config.<a class="code" href="structpayloadtype__config__t.html#a671c4ba30e9bb37f85ea34c722c769d1" title="G726 packing order  Valid values are:  0: Packing none 1: Packing left 2: Packing right...">nG726Packing</a>       = 2;                    <span class="comment">//pack right</span></div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ((codec_config.<a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a> == rtpPayloadG722) ||</div>
<div class="line">                (codec_config.<a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a> == rtpPayloadG722) )</div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#ad82d877ec1c901972f53d166a936c27f" title="PCM Mode Setting  Valid values are:  0: No action (use previous PCM enable mode)  1: Auto mode (DSP w...">nPcmMode</a> = 3;  <span class="comment">// wide-band</span></div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                codec_config.<a class="code" href="structpayloadtype__config__t.html#ad82d877ec1c901972f53d166a936c27f" title="PCM Mode Setting  Valid values are:  0: No action (use previous PCM enable mode)  1: Auto mode (DSP w...">nPcmMode</a> = 2;  <span class="comment">// narrow-band</span></div>
<div class="line"></div>
<div class="line">            <a class="code" href="group__TAPI__DSP__MEDIA.html#ga66c7ebfb55ed123876274a6f61ee6ded" title="Set RTP payload type.">rtk_SetRtpPayloadType</a>(&amp;codec_config);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// start rtp (channel number = 0, session number = 0)</span></div>
<div class="line">            <a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, ActiveSession, <a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa594fa9c4862d7d3d0dba9d0f4e231eea" title="RTP Session- Send/Recv.">rtp_session_sendrecv</a>);</div>
<div class="line">            bStartRTP = 1;</div>
<div class="line"></div>
<div class="line">            printf(<span class="stringliteral">&quot;%s:%d -&gt; %s:%d (codec tx:%d, rx:%d), (frame_no: tx:%d)\n&quot;</span>, </div>
<div class="line">                argv[2], atoi(argv[4]), argv[3], atoi(argv[5]),tx_codec,rx_codec, tx_frame_no);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> SIGN_ONHOOK:</div>
<div class="line">            <span class="comment">// close rtp</span></div>
<div class="line">            <a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, 0, <a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa0f1821892441a90141e10d5e947e912e" title="RTP Session- Inactive.">rtp_session_inactive</a>);</div>
<div class="line">            <a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, 1, <a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa0f1821892441a90141e10d5e947e912e" title="RTP Session- Inactive.">rtp_session_inactive</a>);</div>
<div class="line">            bStartRTP = 0;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// call rtk_OnHookAction at last</span></div>
<div class="line">            <a name="a67"></a><a class="code" href="group__TAPI__PHONE__MISC.html#ga11966890f2e1cacc13e3f525758d2636" title="OnHook Action function. Call this TAPI always when On-Hook event is got.">rtk_OnHookAction</a>(chid);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> SIGN_FLASHHOOK:</div>
<div class="line">            ActiveSession = !ActiveSession;</div>
<div class="line">            <a class="code" href="group__TAPI__MEDIA__MISC.html#gaed19a0479f028247263e839f224c7f56" title="Assign the active session.">rtk_SetTranSessionID</a>(chid, ActiveSession);</div>
<div class="line">            <span class="keywordflow">if</span> (ActiveSession == 1)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Get RTP statistics</span></div>
<div class="line">                <a name="_a68"></a><a class="code" href="structTstRtpRtcpStatistics.html" title="Structure for retrieving RTP/RTCP statistics.">TstRtpRtcpStatistics</a> pRtpRtcpSt;</div>
<div class="line">                <a name="a69"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#gaee4e42063bf203a180d3fa0f0c7c8357" title="Get RTP/RTCP statistics.">rtk_GetRtpRtcpStatistics</a>(chid, ActiveSession, 0, &amp;pRtpRtcpSt);</div>
<div class="line"></div>
<div class="line">                printf(<span class="stringliteral">&quot;\n== RTP 0 Statics ========================\n&quot;</span>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Rx RTP bytes    = %ld\n&quot;</span>,pRtpRtcpSt.<a name="a70"></a><a class="code" href="structTstRtpRtcpStatistics.html#a6c00eccfdb1df2705a8336b572e8bd70" title="octets received">nRxBytes</a>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Rx RTP packets  = %ld\n&quot;</span>,pRtpRtcpSt.<a name="a71"></a><a class="code" href="structTstRtpRtcpStatistics.html#a32d05700bf990ce49837ed90ea5160aa" title="packets received">nRxPkts</a>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Rx packet loss  = %ld\n&quot;</span>,pRtpRtcpSt.<a name="a72"></a><a class="code" href="structTstRtpRtcpStatistics.html#ad1711e93abd50d79b582e88363163393" title="Number of packets lost.">nLost</a>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Tx RTP bytes    = %ld\n&quot;</span>,pRtpRtcpSt.<a name="a73"></a><a class="code" href="structTstRtpRtcpStatistics.html#ab1b29b4be04614e5eb601d34d0a6c1f5" title="octets sent">nTxBytes</a>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Tx RTP packets  = %ld\n&quot;</span>,pRtpRtcpSt.<a name="a74"></a><a class="code" href="structTstRtpRtcpStatistics.html#a45cfddbb0e06149d2254d4d1b1ef6594" title="packets sent">nTxPkts</a>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;=========================================\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">                <span class="comment">// hold session</span></div>
<div class="line">                <a name="a75"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#gaaa753726d4ee3eb96c1cd2183a812248" title="Hold/Resume RTP.">rtk_HoldRtp</a>(chid, 0, 1);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// play a tone. Sounds like &quot;du du du&quot;.</span></div>
<div class="line">                <a name="a76"></a><a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(chid, 1, <a name="a77"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda3d2fcb808d8bc1fc96aa4b3bb5640b62" title="code = 97 in RFC2833, index = 15">DSPCODEC_TONE_CONFIRMATION</a>, 1, <a name="a78"></a><a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// resume session</span></div>
<div class="line">                <a class="code" href="group__TAPI__MEDIA__RTP.html#gaaa753726d4ee3eb96c1cd2183a812248" title="Hold/Resume RTP.">rtk_HoldRtp</a>(chid, 0, 0);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// stop tone</span></div>
<div class="line">                <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(chid, 1, <a name="a79"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        usleep(100000); <span class="comment">// 100ms</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 3 2014 11:37:43 for VoIP Interface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
