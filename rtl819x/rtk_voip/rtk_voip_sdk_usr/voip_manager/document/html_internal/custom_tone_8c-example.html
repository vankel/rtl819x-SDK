<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIP Interface: Main Page2</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<img src=realtek.jpg>
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">custom_tone.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example for customize tone operation.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="voip__manager_8h.html" title="VoIP control API.">voip_manager.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//the ToneTable vlaue can be filled in Web page </span></div>
<div class="line"><a name="_a0"></a><a class="code" href="structTstVoipToneCfg.html" title="Structure for tone configuration.">TstVoipToneCfg</a> ToneTable[] =</div>
<div class="line"><span class="preprocessor">#if 1</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">// China tone example</span></div>
<div class="line">{</div>
<div class="line">    {0, 0, 1, 2000,    0, 0, 0, 0, 0, 0, 0, 0, 1, 350,   0, 0, 0, 7,  0, 0, 0},</div>
<div class="line">    {0, 0, 1, 1000, 4000, 0, 0, 0, 0, 0, 0, 0, 1, 425,   0, 0, 0, 7,  0, 0, 0},</div>
<div class="line">    {0, 0, 1,  400,  400, 0, 0, 0, 0, 0, 0, 0, 1, 425,   0, 0, 0, 7,  0, 0, 0},         </div>
<div class="line">    {0, 0, 1,  200,  200, 0, 0, 0, 0, 0, 0, 0, 1, 425,   0, 0, 0, 7,  0, 0, 0},             </div>
<div class="line">    {0, 0, 1,  200,  200, 0, 0, 0, 0, 0, 0, 0, 1, 425,   0, 0, 0, 7,  0, 0, 0},             </div>
<div class="line">    {0, 1, 1, 1500,    0, 0, 0, 0, 0, 0, 0, 0, 2, 440, 480, 0, 0, 13, 13, 0, 0},            </div>
<div class="line">    {0, 0, 1, 2000, 4000, 0, 0, 0, 0, 0, 0, 0, 2, 440, 480, 0, 0,  7,  7, 0, 0},            </div>
<div class="line">    {0, 0, 0,    0,    0, 0, 0, 0, 0, 0, 0, 0, 0,   0,   0, 0, 0,  0,  0, 0, 0}         </div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>{</div>
<div class="line">    {0, 0, 1, 2000,    0, 0, 0, 0, 0, 0, 0, 0, 2, 350, 440, 0, 0, 13, 13, 0, 0},</div>
<div class="line">    {0, 0, 1, 2000,    0, 0, 0, 0, 0, 0, 0, 0, 1, 100,   0, 0, 0, 13,  0, 0, 0},</div>
<div class="line">    {0, 0, 1, 2000,    0, 0, 0, 0, 0, 0, 0, 0, 2, 350, 440, 0, 0, 13, 13, 0, 0},            </div>
<div class="line">    {0, 0, 1, 2000,    0, 0, 0, 0, 0, 0, 0, 0, 1, 350,   0, 0, 0, 13,  0, 0, 0},                </div>
<div class="line">    {0, 0, 1,  500,  500, 0, 0, 0, 0, 0, 0, 0, 2, 480, 620, 0, 0, 24, 24, 0, 0},            </div>
<div class="line">    {0, 1, 1, 1500,    0, 0, 0, 0, 0, 0, 0, 0, 2, 440, 480, 0, 0, 13, 13, 0, 0},            </div>
<div class="line">    {0, 0, 1, 2000, 4000, 0, 0, 0, 0, 0, 0, 0, 2, 440, 480, 0, 0,  7,  7, 0, 0},            </div>
<div class="line">    {0, 0, 0,    0,    0, 0, 0, 0, 0, 0, 0, 0, 0,   0,   0, 0, 0,  0,  0, 0, 0}         </div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">void</span> SetCustomTone(<span class="keywordtype">void</span>);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <a class="code" href="voip__manager_8h.html#ac3d830d3c2e104857c0628ae98e456f8">SIGNSTATE</a> val;  </div>
<div class="line">    </div>
<div class="line">    SetCustomTone();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;CON_CH_NUM; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>( !RTK_VOIP_IS_SLIC_CH( i, <a name="a1"></a>g_VoIP_Feature ) )</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        </div>
<div class="line">        <a name="a2"></a><a class="code" href="group__TAPI__DSP__AGC.html#gad577eab02d68e9ffaa9c9d32bf2cbda0" title="Set the speaker and mic voice gain.">rtk_SetVoiceGain</a>(i, 0, 0);</div>
<div class="line">        <a name="a3"></a><a class="code" href="group__TAPI__PHONE__FXS.html#ga7f354b2656a3dfe992a1c10d0d769a5e" title="Setup the flash hook time.">rtk_SetFlashHookTime</a>(i, 0, 300);</div>
<div class="line">        <a name="a4"></a><a class="code" href="group__TAPI__PHONE__EVENT.html#ga360048e105becaf697d40d0319655470" title="Flush the VoIP kernel used FIFO.">rtk_SetFlushFifo</a>(i);                    <span class="comment">// flush kernel fifo before app run</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">main_loop:</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;CON_CH_NUM; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>( !RTK_VOIP_IS_SLIC_CH( i, g_VoIP_Feature ) )</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">            </div>
<div class="line">        <a name="a5"></a><a class="code" href="group__TAPI__OBSOLETE__GROUP.html#ga09c56bc79918bd82b057736c05905fde" title="Get the FXS state.">rtk_GetFxsEvent</a>(i, &amp;val);</div>
<div class="line">        <span class="keywordflow">switch</span> (val)</div>
<div class="line">        {</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY1:</div>
<div class="line">            <a name="a6"></a><a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a name="a7"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a name="a8"></a><a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a name="a9"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda5e89cb5eae76c4ce84c6f8f09cf0e1ed" title="code = 66 in RFC2833, index = 12">DSPCODEC_TONE_DIAL</a>, 1, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY2:</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a name="a10"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda7a9e5f38b257cea629fc98f17ccccfb9" title="ring back tone, code = 70 in RFC2833, index = 16">DSPCODEC_TONE_RINGING</a>, 1, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY3:</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a name="a11"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda04e7a0c45a2c093d03effac94b749516" title="code = 72 in RFC2833, index = 17">DSPCODEC_TONE_BUSY</a>, 1, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY4:</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a name="a12"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1ddaab762181a4a5bb9d23f083f9c32a6062" title="code = 79 in RFC2833, index = 27">DSPCODEC_TONE_CALL_WAITING</a>, 1, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY5:</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a name="a13"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda20d0b05cc92e73f0307e15cb613138fb" title="code = 73 in RFC2833, index = 18">DSPCODEC_TONE_CONGESTION</a>, 1, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_ONHOOK:</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <a name="a14"></a><a class="code" href="group__TAPI__PHONE__MISC.html#ga11966890f2e1cacc13e3f525758d2636" title="OnHook Action function. Call this TAPI always when On-Hook event is got.">rtk_OnHookAction</a>(i);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_OFFHOOK:</div>
<div class="line">            <a name="a15"></a><a class="code" href="group__TAPI__PHONE__MISC.html#gad0fba4da59d7db9bb24f88ca30c2ad34" title="OffHook Action function. Call this TAPI always when Off-Hook event is got.">rtk_OffHookAction</a>(i);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_FLASHHOOK:</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(i, 0, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 1, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_NONE:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_OFFHOOK_2:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;unknown(%d)\n&quot;</span>, val);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        usleep(100000 / CON_CH_NUM); <span class="comment">// 100 ms</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">goto</span> main_loop;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> SetCustomTone()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> cust_idx;</div>
<div class="line">    </div>
<div class="line">    st_ToneCfgParam custom_tone[TONE_CUSTOMER_MAX];</div>
<div class="line">    </div>
<div class="line">    voipCfgParam_t VoIPCfg;</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    memcpy(custom_tone, ToneTable, TONE_CUSTOMER_MAX*<span class="keyword">sizeof</span>(st_ToneCfgParam));</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (cust_idx=0; cust_idx &lt; TONE_CUSTOMER_MAX; cust_idx++)</div>
<div class="line">    {</div>
<div class="line">        <a name="a16"></a><a class="code" href="group__TAPI__DSP__TONE.html#gacc65982f1bb6cc7fab0a7311cc38328e" title="Set the custom tone.">rtk_SetCustomTone</a>(cust_idx, &amp;custom_tone[cust_idx]);</div>
<div class="line">    }   </div>
<div class="line">    </div>
<div class="line">    VoIPCfg.tone_of_country = TONE_CUSTOMER; <span class="comment">//Custom</span></div>
<div class="line">    VoIPCfg.tone_of_custdial = 0;</div>
<div class="line">    VoIPCfg.tone_of_custring = 1;</div>
<div class="line">    VoIPCfg.tone_of_custbusy = 2;</div>
<div class="line">    VoIPCfg.tone_of_custwaiting = 3;</div>
<div class="line">    </div>
<div class="line">    <a name="a17"></a><a class="code" href="group__TAPI__DSP__TONE.html#ga9bced4cf34d07cd855036ac03b30fff6" title="Set the call-progress tone, busy tone detection parametes and SLIC/DAA impedance according to the sel...">rtk_SetCountry</a>(&amp;VoIPCfg);</div>
<div class="line">    <span class="comment">/* set congestion tone */</span></div>
<div class="line">    <a name="a18"></a><a class="code" href="group__TAPI__DSP__TONE.html#ga7657cdaab5983e2698a98a38ed6804a0" title="Set the update tone.">rtk_SetUpdateTone</a>(TONE_CUSTOMER, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda20d0b05cc92e73f0307e15cb613138fb" title="code = 73 in RFC2833, index = 18">DSPCODEC_TONE_CONGESTION</a>, &amp;custom_tone[4]);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 3 2014 11:37:43 for VoIP Interface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
