<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIP Interface: Main Page2</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<img src=realtek.jpg>
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">conference.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example for conference</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="voip__manager_8h.html" title="VoIP control API.">voip_manager.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define MAX_SESSION  2  //(SESS_NUM / VOIP_CH_NUM)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">enum</span> {</div>
<div class="line">    STATE_IDLE = 0,</div>
<div class="line">    STATE_RTP</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> chid, ssid;</div>
<div class="line">    <a class="code" href="voip__manager_8h.html#ac3d830d3c2e104857c0628ae98e456f8">SIGNSTATE</a> val;</div>
<div class="line">    <a name="_a0"></a><a class="code" href="structrtp__config__t.html" title="Structure for RTP handling  ">rtp_config_t</a> rtp_config[CON_CH_NUM][MAX_SESSION];</div>
<div class="line">    <a name="_a1"></a><a class="code" href="structpayloadtype__config__t.html" title="Structure for RTP payload type  ">payloadtype_config_t</a> codec_config[CON_CH_NUM][MAX_SESSION];</div>
<div class="line">    <a name="_a2"></a><a class="code" href="structTstVoipMgr3WayCfg.html" title="Structure for three way conference.">TstVoipMgr3WayCfg</a> stVoipMgr3WayCfg;</div>
<div class="line">    <span class="keywordtype">int</span> ActiveSession[CON_CH_NUM];</div>
<div class="line">    <span class="keywordtype">int</span> session_state[CON_CH_NUM][MAX_SESSION];</div>
<div class="line">    <span class="keywordtype">int</span> dtmf_val[SIGN_HASH + 1] = {0,1,2,3,4,5,6,7,8,9,0,10,11};</div>
<div class="line">    <span class="keywordtype">char</span> dial_val[SIGN_HASH + 1] = {<span class="charliteral">&#39;\0&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;2&#39;</span>, <span class="charliteral">&#39;3&#39;</span>, <span class="charliteral">&#39;4&#39;</span>, <span class="charliteral">&#39;5&#39;</span>, <span class="charliteral">&#39;6&#39;</span>, <span class="charliteral">&#39;7&#39;</span>, <span class="charliteral">&#39;8&#39;</span>, <span class="charliteral">&#39;9&#39;</span>, <span class="charliteral">&#39;0&#39;</span>, <span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;#&#39;</span>};</div>
<div class="line">    <span class="keywordtype">char</span> dial_code[CON_CH_NUM][256];</div>
<div class="line">    <span class="keywordtype">int</span> dial_index[CON_CH_NUM];</div>
<div class="line">    <span class="keywordtype">int</span> i, j;</div>
<div class="line">    <span class="keywordtype">char</span> *src_ip;</div>
<div class="line">    <span class="keywordtype">int</span>  src_port;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argc == 2)</div>
<div class="line">    {</div>
<div class="line">        src_ip = argv[1];</div>
<div class="line">        src_port = 9000;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 3)</div>
<div class="line">    {</div>
<div class="line">        src_ip = argv[1];</div>
<div class="line">        src_port = atoi(argv[2]);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;usage: %s src_ip [src_port]\n&quot;</span>, argv[0]);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    memset( dial_index, 0, <span class="keyword">sizeof</span>( dial_index ) );  <span class="comment">// avoid warning: &quot;may be used uninitialized&quot; </span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// init</span></div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;CON_CH_NUM; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>( !RTK_VOIP_IS_SLIC_CH( i, <a name="a3"></a>g_VoIP_Feature ) )</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">            </div>
<div class="line">        <a name="a4"></a><a class="code" href="group__TAPI__DSP__INIT.html#ga4b32be720cdd238fb82cf0bad3db2114" title="Interface Initialization.">rtk_InitDsp</a>(i);</div>
<div class="line">        <a name="a5"></a><a class="code" href="group__TAPI__PHONE__FXS.html#ga7f354b2656a3dfe992a1c10d0d769a5e" title="Setup the flash hook time.">rtk_SetFlashHookTime</a>(i, 0, 300);        <span class="comment">// 0~300 ms</span></div>
<div class="line">        <a name="a6"></a><a class="code" href="group__TAPI__PHONE__EVENT.html#ga360048e105becaf697d40d0319655470" title="Flush the VoIP kernel used FIFO.">rtk_SetFlushFifo</a>(i);                    <span class="comment">// flush kernel fifo before app run</span></div>
<div class="line">        <a name="a7"></a><a class="code" href="group__TAPI__DSP__CID__DTMF.html#gab8245d14b7a7a684e1aa25e1188c137b" title="Set the DTMF mode.">rtk_SetDtmfMode</a>(i, DTMF_RFC2833);       <span class="comment">// set dtmf mode</span></div>
<div class="line">        ActiveSession[i] = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (j=0; j&lt;MAX_SESSION; j++)</div>
<div class="line">        {</div>
<div class="line">            session_state[i][j] = STATE_IDLE;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">main_loop:</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (chid=0; chid&lt;CON_CH_NUM; chid++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//if( !RTK_VOIP_IS_SLIC_CH( i, g_VoIP_Feature ) )</span></div>
<div class="line">        <span class="comment">//  continue;</span></div>
<div class="line">            </div>
<div class="line">        <a name="a8"></a><a class="code" href="group__TAPI__OBSOLETE__GROUP.html#ga09c56bc79918bd82b057736c05905fde" title="Get the FXS state.">rtk_GetFxsEvent</a>(chid, &amp;val);</div>
<div class="line">        <span class="keywordflow">switch</span> (val)</div>
<div class="line">        {</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY1:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY2:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY3:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY4:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY5:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY6:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY7:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY8:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY9:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_KEY0:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_STAR:</div>
<div class="line">        <span class="keywordflow">case</span> SIGN_HASH:</div>
<div class="line">        {</div>
<div class="line">            ssid = ActiveSession[chid];</div>
<div class="line">            <span class="keywordflow">if</span> (session_state[chid][ssid] == STATE_RTP)</div>
<div class="line">            {</div>
<div class="line">                <a name="a9"></a><a class="code" href="group__TAPI__MEDIA__RFC2833.html#ga73a83fa0a1b6d81f5324f1ade559e0ab" title="Send DTMF via RFC2833.">rtk_SetRtpRfc2833</a>(chid, ssid, dtmf_val[val], 100);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val == SIGN_HASH)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">char</span> *pPort;</div>
<div class="line">                <span class="keywordtype">char</span> *dest_ip;</div>
<div class="line">                <span class="keywordtype">int</span> dest_port;</div>
<div class="line"></div>
<div class="line">                dial_code[chid][dial_index[chid]] = 0;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// 192.168.1.1..9002 =&gt; ip: 192.168.1.1, rtp port:9002</span></div>
<div class="line">                pPort = strstr(dial_code[chid], <span class="stringliteral">&quot;..&quot;</span>);  </div>
<div class="line">                <span class="keywordflow">if</span> (pPort)</div>
<div class="line">                {</div>
<div class="line">                    *pPort = 0;</div>
<div class="line">                    pPort += 2;</div>
<div class="line">                    dest_ip = dial_code[chid];</div>
<div class="line">                    dest_port = atoi(pPort);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    dest_ip = dial_code[chid];</div>
<div class="line">                    dest_port = 9000;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                src_port = dest_port;</div>
<div class="line">                </div>
<div class="line">                <span class="comment">// set rtp session</span></div>
<div class="line">                rtp_config[chid][ssid].<a name="a10"></a><a class="code" href="structrtp__config__t.html#a6835ba1d83a5bcc4bd0af7d83076ea6a" title="channel id">chid</a> = chid;     <span class="comment">// use channel 0</span></div>
<div class="line">                rtp_config[chid][ssid].<a name="a11"></a><a class="code" href="structrtp__config__t.html#ae30a7620430762b93c1792477cb0eaeb" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a> = ssid;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a12"></a><a class="code" href="structrtp__config__t.html#a1630c48e70b3818c1b46fa3d2ee0a8ef" title="Not support yet. tcp = 1 or udp = 0.">isTcp</a> = 0;       <span class="comment">// use udp</span></div>
<div class="line">                rtp_config[chid][ssid].<a name="a13"></a><a class="code" href="structrtp__config__t.html#ab99c37801711581655f5833a38f70044" title="local IP address for RTP">extIp</a> = inet_addr(src_ip);</div>
<div class="line">                rtp_config[chid][ssid].<a name="a14"></a><a class="code" href="structrtp__config__t.html#a959b92e3bb71c4d081f1dd7975906d9f" title="remote IP address for RTP">remIp</a> = inet_addr(dest_ip);</div>
<div class="line">                <span class="comment">//rtp_config[chid][ssid].extPort = htons(src_port + chid * 2);</span></div>
<div class="line">                rtp_config[chid][ssid].<a name="a15"></a><a class="code" href="structrtp__config__t.html#ae95db080a339d14e8c5860a689d55e35" title="local RTP port number">extPort</a> = htons(src_port);</div>
<div class="line">                rtp_config[chid][ssid].<a name="a16"></a><a class="code" href="structrtp__config__t.html#a427f96d3294a74896580c54c2fa8a171" title="remote RTP port number">remPort</a> = htons(dest_port);</div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_VOICE_QOS</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config[chid][ssid].tos = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config[chid][ssid].<a name="a17"></a><a class="code" href="structrtp__config__t.html#a217fe384b06c22665689c5c558ed795d" title="local rfc2833 payload type  rfc2833_payload_type_locale MUST be set from application to DSP...">rfc2833_payload_type_local</a> = 96;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a18"></a><a class="code" href="structrtp__config__t.html#aa50cbeaa509c7554e85fe2c125ed6cca" title="remote rfc2833 payload type  rfc2833_payload_type_remote MUST be set from application to DSP...">rfc2833_payload_type_remote</a> = 96;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a19"></a><a class="code" href="structrtp__config__t.html#ad5526fa524c914af80c5ab112b850536" title="local Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_local</a> = 101;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a20"></a><a class="code" href="structrtp__config__t.html#a65be43b15030c9d62a09e47e5c670841" title="remote Fax/Modem rfc2833 payload type">rfc2833_fax_modem_pt_remote</a> = 101;</div>
<div class="line"><span class="preprocessor">#if defined(SUPPORT_RTP_REDUNDANT_APP)</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config[chid][ssid].<a name="a21"></a><a class="code" href="structrtp__config__t.html#abacf7214ccfa686dde4da5c47797fb7f" title="Payload type of local redundant rtp. 0 means disable rtp redundant.">rtp_redundant_payload_type_local</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a22"></a><a class="code" href="structrtp__config__t.html#a584d18c8335c56d12c61a324af24eab8" title="Payload type of remote redundant rtp 0 means disable rtp redundant.">rtp_redundant_payload_type_remote</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a23"></a><a class="code" href="structrtp__config__t.html#aefa61ecebb4c33ad03b235b7d8282e56" title="Maximum RTP redundancy number in TX direction (0~2). 0 means no RTP redundancy.">rtp_redundant_max_Audio</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a24"></a><a class="code" href="structrtp__config__t.html#a5649f8db4f869bb73fc3d9337ba7cb98" title="Maximum RFC 2833 redundancy number in TX direction (0~5). 0 means no RFC 2833 redundancy.">rtp_redundant_max_RFC2833</a> = 0;</div>
<div class="line"><span class="preprocessor">#elif defined(SUPPORT_RTP_REDUNDANT)                </span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config[chid][ssid].<a class="code" href="structrtp__config__t.html#abacf7214ccfa686dde4da5c47797fb7f" title="Payload type of local redundant rtp. 0 means disable rtp redundant.">rtp_redundant_payload_type_local</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a class="code" href="structrtp__config__t.html#a584d18c8335c56d12c61a324af24eab8" title="Payload type of remote redundant rtp 0 means disable rtp redundant.">rtp_redundant_payload_type_remote</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a class="code" href="structrtp__config__t.html#aefa61ecebb4c33ad03b235b7d8282e56" title="Maximum RTP redundancy number in TX direction (0~2). 0 means no RTP redundancy.">rtp_redundant_max_Audio</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a class="code" href="structrtp__config__t.html#a5649f8db4f869bb73fc3d9337ba7cb98" title="Maximum RFC 2833 redundancy number in TX direction (0~5). 0 means no RFC 2833 redundancy.">rtp_redundant_max_RFC2833</a> = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config[chid][ssid].<a name="a25"></a><a class="code" href="structrtp__config__t.html#ae539171a25479d0ef291c01aea8741c8" title="Payload type of local SID (Silence Insertion Description). 13 is recommend.">SID_payload_type_local</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a26"></a><a class="code" href="structrtp__config__t.html#a251fe201cd44524df63f076a8756ad71" title="Payload type of remote SID (Silence Insertion Description). 13 is recommend.">SID_payload_type_remote</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a27"></a><a class="code" href="structrtp__config__t.html#a864753145110bf95e0a4b86ad32a2dcc" title="initialize seqno, SSRC and timestamp randomly, so ignore below parameters">init_randomly</a> = 1;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a28"></a><a class="code" href="structrtp__config__t.html#ab2fdc41617ee0e672181577c00944219" title="initial seqno">init_seqno</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a29"></a><a class="code" href="structrtp__config__t.html#abf984d1afc9ee6616d163d1ecc04b28d" title="initial SSRC">init_SSRC</a> = 0;</div>
<div class="line">                rtp_config[chid][ssid].<a name="a30"></a><a class="code" href="structrtp__config__t.html#a70cd97dacde76a2364592cc3db18a0be" title="initial timestamp">init_timestamp</a> = 0;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_RTK_VOIP_IPV6_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>                rtp_config[chid][ssid].ipv6 = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                <a name="a31"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#ga20fe6f6be15faef8c57328ab22f95393" title="Set RTP configuration.">rtk_SetRtpConfig</a>(&amp;rtp_config[chid][ssid]);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// set rtp payload, and other session parameters.</span></div>
<div class="line">                codec_config[chid][ssid].<a name="a32"></a><a class="code" href="structpayloadtype__config__t.html#a7a81ef5b12c7b2c492e2f466402b3fba" title="channel id">chid</a> = chid;       <span class="comment">// use channel 0</span></div>
<div class="line">                codec_config[chid][ssid].<a name="a33"></a><a class="code" href="structpayloadtype__config__t.html#a717481154070dc5fe2399c656c661ace" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a> = ssid;</div>
<div class="line">                codec_config[chid][ssid].<a name="a34"></a><a class="code" href="structpayloadtype__config__t.html#af983fd7e21d7a15b3e01dd835a070261" title="Payload type of local voice codec.">local_pt</a> = 0;      <span class="comment">// PCMU use pt 0</span></div>
<div class="line">                codec_config[chid][ssid].<a name="a35"></a><a class="code" href="structpayloadtype__config__t.html#a715fb4beb036ad7703243258c88e4c9a" title="Payload type of remote voice codec.">remote_pt</a> = 0;     <span class="comment">// PCMU use pt 0</span></div>
<div class="line">                codec_config[chid][ssid].<a name="a36"></a><a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a> = rtpPayloadPCMU;</div>
<div class="line">                codec_config[chid][ssid].<a name="a37"></a><a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a> = rtpPayloadPCMU;</div>
<div class="line">                codec_config[chid][ssid].<a name="a38"></a><a class="code" href="structpayloadtype__config__t.html#aac8c4492c426f10e4ee22ce5838c801b" title="Payload type of local voice band data (vbd).">local_pt_vbd</a> = rtpPayloadUndefined;</div>
<div class="line">                codec_config[chid][ssid].<a name="a39"></a><a class="code" href="structpayloadtype__config__t.html#a45b5dd95db0de40fe811c2c890fc716d" title="Payload type in remote voice band data (vbd).">remote_pt_vbd</a> = rtpPayloadUndefined;</div>
<div class="line">                codec_config[chid][ssid].<a name="a40"></a><a class="code" href="structpayloadtype__config__t.html#ada6bbf4c14e274e6adc90ac51a38494c" title="Codec type of voice band data (vbd). Usually used by V.152 FAX.">uPktFormat_vbd</a> = rtpPayloadUndefined;</div>
<div class="line">                codec_config[chid][ssid].<a name="a41"></a><a class="code" href="structpayloadtype__config__t.html#a51db5ebb75d4929816d0aa4967d2bc49" title="G.723.1 rate. There are two bit rates at which G.723.1 can operate.  Valid values are:  0: 6...">nG723Type</a> = 0;</div>
<div class="line">                codec_config[chid][ssid].<a name="a42"></a><a class="code" href="structpayloadtype__config__t.html#a921c890c8d1f7ae8b8cc0cabf27bf778" title="Frame per packet of local (Tx) voice codec.">nLocalFramePerPacket</a> = 1;</div>
<div class="line">                codec_config[chid][ssid].<a name="a43"></a><a class="code" href="structpayloadtype__config__t.html#a5ec2b162f986c6016bf17dddd98c93d3" title="Frame per packet of remote (Rx) voice codec.">nRemoteFramePerPacket</a> = 1;</div>
<div class="line">                codec_config[chid][ssid].<a name="a44"></a><a class="code" href="structpayloadtype__config__t.html#a0760774c59b4302c41a13c3f20ee971e" title="Frame per packet of voice codec (vbd)">nFramePerPacket_vbd</a> = 1;</div>
<div class="line">                codec_config[chid][ssid].<a name="a45"></a><a class="code" href="structpayloadtype__config__t.html#aba143d7f2f2e9130cc729056b3668e66" title="Enable/Disable VAD (Voice activity detection)  Valid values are: 0: Disable 1: Enable.">bVAD</a> = 0;</div>
<div class="line">                codec_config[chid][ssid].<a name="a46"></a><a class="code" href="structpayloadtype__config__t.html#ae31dc1e199838d927b4ff751e4dc4d5a" title="Enable/Disable PLC (Packet Loss Concealment)  Valid values are: 0: Disable 1: Enable.">bPLC</a> = 1;</div>
<div class="line">                codec_config[chid][ssid].<a name="a47"></a><a class="code" href="structpayloadtype__config__t.html#a5edd303e38c49d0870ae64c0682b0bd1" title="minimun jitter delay (10ms)  nJitterDelay is the minimum delay of jitter buffer.  Valid values are 4 ...">nJitterDelay</a> = 4;</div>
<div class="line">                codec_config[chid][ssid].<a name="a48"></a><a class="code" href="structpayloadtype__config__t.html#a1cf71efa5a26840869adc9ce70812506" title="maximum jitter delay (10ms)  nJitterDelay is the maximum delay of jitter buffer.  Valid values are 13...">nMaxDelay</a> = 13;</div>
<div class="line">                codec_config[chid][ssid].<a name="a49"></a><a class="code" href="structpayloadtype__config__t.html#a2994da36a394d9edf2ff126817181e48" title="maximum strict jitter delay (10ms)  nMaxStrictDelay is the maximum strict delay of jitter buffer...">nMaxStrictDelay</a> = 10000;</div>
<div class="line">                codec_config[chid][ssid].<a name="a50"></a><a class="code" href="structpayloadtype__config__t.html#a2435652e35b35df20454edaeca7942d0" title="optimzation factor of jitter buffer  The optimization factor is the value for adjusting the quality o...">nJitterFactor</a> = 7;</div>
<div class="line">                codec_config[chid][ssid].<a name="a51"></a><a class="code" href="structpayloadtype__config__t.html#a671c4ba30e9bb37f85ea34c722c769d1" title="G726 packing order  Valid values are:  0: Packing none 1: Packing left 2: Packing right...">nG726Packing</a> = 2;<span class="comment">//pack right</span></div>
<div class="line">                <span class="keywordflow">if</span> ((codec_config[chid][ssid].uLocalPktFormat == rtpPayloadG722) ||</div>
<div class="line">                    (codec_config[chid][ssid].uRemotePktFormat == rtpPayloadG722) )</div>
<div class="line">                    codec_config[chid][ssid].<a name="a52"></a><a class="code" href="structpayloadtype__config__t.html#ad82d877ec1c901972f53d166a936c27f" title="PCM Mode Setting  Valid values are:  0: No action (use previous PCM enable mode)  1: Auto mode (DSP w...">nPcmMode</a> = 3;  <span class="comment">// wide-band</span></div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    codec_config[chid][ssid].<a class="code" href="structpayloadtype__config__t.html#ad82d877ec1c901972f53d166a936c27f" title="PCM Mode Setting  Valid values are:  0: No action (use previous PCM enable mode)  1: Auto mode (DSP w...">nPcmMode</a> = 2;  <span class="comment">// narrow-band</span></div>
<div class="line">                <a name="a53"></a><a class="code" href="group__TAPI__DSP__MEDIA.html#ga66c7ebfb55ed123876274a6f61ee6ded" title="Set RTP payload type.">rtk_SetRtpPayloadType</a>(&amp;codec_config[chid][ssid]);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// start rtp (channel number = 0, session number = 0)</span></div>
<div class="line">                <a name="a54"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, ssid, <a name="a55"></a><a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa594fa9c4862d7d3d0dba9d0f4e231eea" title="RTP Session- Send/Recv.">rtp_session_sendrecv</a>);</div>
<div class="line"></div>
<div class="line">                session_state[chid][ssid] = STATE_RTP;</div>
<div class="line">            </div>
<div class="line">                printf(<span class="stringliteral">&quot;%s:%d -&gt; %s:%d\n&quot;</span>,</div>
<div class="line">                    src_ip, src_port + chid * 2, dest_ip, dest_port);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// stop dial tone in current session</span></div>
<div class="line">                <a name="a56"></a><a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(chid, ssid, <a name="a57"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a name="a58"></a><a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">                dial_code[chid][dial_index[chid]++] = dial_val[val];</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> SIGN_OFFHOOK:</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// do rtk_SLIC_Offhook_Action at first</span></div>
<div class="line">            <a name="a59"></a><a class="code" href="group__TAPI__PHONE__MISC.html#gad0fba4da59d7db9bb24f88ca30c2ad34" title="OffHook Action function. Call this TAPI always when Off-Hook event is got.">rtk_OffHookAction</a>(chid);</div>
<div class="line">            <a name="a60"></a><a class="code" href="group__TAPI__MEDIA__MISC.html#gaed19a0479f028247263e839f224c7f56" title="Assign the active session.">rtk_SetTranSessionID</a>(chid, 0);</div>
<div class="line">            ActiveSession[chid] = 0;</div>
<div class="line">            dial_index[chid] = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (i=0; i&lt;MAX_SESSION; i++)</div>
<div class="line">            {</div>
<div class="line">                session_state[chid][i] = STATE_IDLE;</div>
<div class="line">            }</div>
<div class="line">            <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(chid, 0, <a name="a61"></a><a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda5e89cb5eae76c4ce84c6f8f09cf0e1ed" title="code = 66 in RFC2833, index = 12">DSPCODEC_TONE_DIAL</a>, 1, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);  <span class="comment">// play dial tone</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> SIGN_ONHOOK:</div>
<div class="line">            <span class="keywordflow">for</span> (i=0; i&lt;MAX_SESSION; i++)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="group__TAPI__MEDIA__RTP.html#ga2631053cf4aad5f78aa3d821ceed68d8" title="Set RTP Session State.">rtk_SetRtpSessionState</a>(chid, i, <a name="a62"></a><a class="code" href="voip__params_8h.html#a45391b9619a66d534df49c84149a4fcaa0f1821892441a90141e10d5e947e912e" title="RTP Session- Inactive.">rtp_session_inactive</a>);</div>
<div class="line">                <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(chid, i, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>); <span class="comment">// stop tone</span></div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// clear resource count</span></div>
<div class="line">            <a class="code" href="group__TAPI__MEDIA__MISC.html#gaed19a0479f028247263e839f224c7f56" title="Assign the active session.">rtk_SetTranSessionID</a>(chid, 255);    </div>
<div class="line">            <span class="comment">// close conference</span></div>
<div class="line">            memset(&amp;stVoipMgr3WayCfg, 0, <span class="keyword">sizeof</span>(stVoipMgr3WayCfg));</div>
<div class="line">            stVoipMgr3WayCfg.<a name="a63"></a><a class="code" href="structTstVoipMgr3WayCfg.html#a3265e331b89de2845e3599e18642a349" title="Channel ID.">ch_id</a> = chid;</div>
<div class="line">            stVoipMgr3WayCfg.<a name="a64"></a><a class="code" href="structTstVoipMgr3WayCfg.html#a170d129c937cb3cdd5d3dea84f257fbd" title="Enable or disable three way conference.">enable</a> = 0;</div>
<div class="line">            <a name="a65"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#gac63c0aa5b5f1f68d6cef7bb0cea2a96a" title="Enable/Disable conference.">rtk_SetConference</a>(&amp;stVoipMgr3WayCfg);</div>
<div class="line">            <span class="comment">// do rtk_SLIC_Onhook_Action at last</span></div>
<div class="line">            <a name="a66"></a><a class="code" href="group__TAPI__PHONE__MISC.html#ga11966890f2e1cacc13e3f525758d2636" title="OnHook Action function. Call this TAPI always when On-Hook event is got.">rtk_OnHookAction</a>(chid);     </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> SIGN_FLASHHOOK:</div>
<div class="line">        {</div>
<div class="line">            dial_index[chid] = 0;</div>
<div class="line">            ssid = ActiveSession[chid];</div>
<div class="line">            <span class="keywordflow">if</span> (session_state[chid][ssid] == STATE_RTP)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// check another session state</span></div>
<div class="line">                <span class="keywordflow">if</span> (session_state[chid][!ssid] == STATE_IDLE) </div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// hold current session</span></div>
<div class="line">                    <a name="a67"></a><a class="code" href="group__TAPI__MEDIA__RTP.html#gaaa753726d4ee3eb96c1cd2183a812248" title="Hold/Resume RTP.">rtk_HoldRtp</a>(chid, ssid, 1);</div>
<div class="line">                    <span class="comment">// change to new session </span></div>
<div class="line">                    ssid = !ssid;</div>
<div class="line">                    ActiveSession[chid] = ssid;</div>
<div class="line">                    <a class="code" href="group__TAPI__MEDIA__MISC.html#gaed19a0479f028247263e839f224c7f56" title="Assign the active session.">rtk_SetTranSessionID</a>(chid, ssid);</div>
<div class="line">                    <span class="comment">// play dial tone in new session</span></div>
<div class="line">                    <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(chid, ssid, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda5e89cb5eae76c4ce84c6f8f09cf0e1ed" title="code = 66 in RFC2833, index = 12">DSPCODEC_TONE_DIAL</a>, 1, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// resume another session</span></div>
<div class="line">                    <a class="code" href="group__TAPI__MEDIA__RTP.html#gaaa753726d4ee3eb96c1cd2183a812248" title="Hold/Resume RTP.">rtk_HoldRtp</a>(chid, !ssid, 0);</div>
<div class="line">                    <span class="comment">// do conference</span></div>
<div class="line">                    memset(&amp;stVoipMgr3WayCfg, 0, <span class="keyword">sizeof</span>(stVoipMgr3WayCfg));</div>
<div class="line">                    stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a3265e331b89de2845e3599e18642a349" title="Channel ID.">ch_id</a> = chid;</div>
<div class="line">                    stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a170d129c937cb3cdd5d3dea84f257fbd" title="Enable or disable three way conference.">enable</a> = 1;</div>
<div class="line">                    <span class="keywordflow">for</span> (i=0; i&lt;MAX_SESSION; i++)</div>
<div class="line">                    {</div>
<div class="line">                        stVoipMgr3WayCfg.<a name="a68"></a><a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a69"></a><a class="code" href="structTstVoipMgrRtpCfg.html#abc8194106834eb01aa2ecbfd2a7e0a5c" title="Channel ID.">ch_id</a> = chid;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a70"></a><a class="code" href="structTstVoipMgrRtpCfg.html#aefde38f16d7feb348e0f0b9661ab094b" title="Media ID.">m_id</a> = rtp_config[chid][i].<a class="code" href="structrtp__config__t.html#ae30a7620430762b93c1792477cb0eaeb" title="session id. Usually 0 for master session, 1 for slave(conference) session.">sid</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a71"></a><a class="code" href="structTstVoipMgrRtpCfg.html#aea35685d9b455a2acd2d1d6e66b043c4" title="Source IP address.">ip_src_addr</a> = rtp_config[chid][i].<a class="code" href="structrtp__config__t.html#a959b92e3bb71c4d081f1dd7975906d9f" title="remote IP address for RTP">remIp</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a72"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a93ae980cc290361445eea0cbb48157ac" title="Destination port.">ip_dst_addr</a> = rtp_config[chid][i].<a class="code" href="structrtp__config__t.html#ab99c37801711581655f5833a38f70044" title="local IP address for RTP">extIp</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a73"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a3e371646f17364af55d4eca92068ab2f" title="Source port.">udp_src_port</a> = rtp_config[chid][i].<a class="code" href="structrtp__config__t.html#a427f96d3294a74896580c54c2fa8a171" title="remote RTP port number">remPort</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a74"></a><a class="code" href="structTstVoipMgrRtpCfg.html#af70551d9182ffb7546e2fc5a15c373cd" title="Destination port.">udp_dst_port</a> = rtp_config[chid][i].<a class="code" href="structrtp__config__t.html#ae95db080a339d14e8c5860a689d55e35" title="local RTP port number">extPort</a>;</div>
<div class="line"><span class="preprocessor">#ifdef SUPPORT_VOICE_QOS</span></div>
<div class="line"><span class="preprocessor"></span>                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a75"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a89e3eef80a3fc8cf692e8e2fe8545bc6" title="TOS for IP header.">tos</a> = rtp_config[chid][i].tos;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a76"></a><a class="code" href="structTstVoipMgrRtpCfg.html#afdc47be4576ed1fa997ab2f616e6ec2e" title="Local payload type of RFC2833.">rfc2833_payload_type_local</a> = </div>
<div class="line">                            rtp_config[chid][i].<a class="code" href="structrtp__config__t.html#a217fe384b06c22665689c5c558ed795d" title="local rfc2833 payload type  rfc2833_payload_type_locale MUST be set from application to DSP...">rfc2833_payload_type_local</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a77"></a><a class="code" href="structTstVoipMgrRtpCfg.html#aff267ced1589963ae2835f0f2cb391c9" title="Remote payload type of RFC2833.">rfc2833_payload_type_remote</a> = </div>
<div class="line">                            rtp_config[chid][i].<a class="code" href="structrtp__config__t.html#aa50cbeaa509c7554e85fe2c125ed6cca" title="remote rfc2833 payload type  rfc2833_payload_type_remote MUST be set from application to DSP...">rfc2833_payload_type_remote</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a78"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a5499aaf4fda44f94f8751ae8b79edfba" title="Local payload type.">local_pt</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#af983fd7e21d7a15b3e01dd835a070261" title="Payload type of local voice codec.">local_pt</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a79"></a><a class="code" href="structTstVoipMgrRtpCfg.html#afa3d0cccc61cb7a5c898b02befb91a17" title="Remote answer payload type.">remote_pt</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a715fb4beb036ad7703243258c88e4c9a" title="Payload type of remote voice codec.">remote_pt</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a80"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a95500ff596f14c12b3aebf3b627c8c56" title="RTK_VoIP predefined local payload type.">uLocalPktFormat</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a82eb57ddce9ba8e980f700f37418455c" title="Codec of desired local(Tx) voice codec.">uLocalPktFormat</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a81"></a><a class="code" href="structTstVoipMgrRtpCfg.html#aa68a565f5533bf29af17003ed0403406" title="RTK_VoIP predefined remote payload type.">uRemotePktFormat</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a895a3d53bfe8b656f96125c3322e49db" title="Codec of desired remote(Rx) voice codec.">uRemotePktFormat</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a82"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a263d1faf4d0ba34b93984fe4370ad414" title="G.723 bitrate.">nG723Type</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a51db5ebb75d4929816d0aa4967d2bc49" title="G.723.1 rate. There are two bit rates at which G.723.1 can operate.  Valid values are:  0: 6...">nG723Type</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a83"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a3efb4c081f685ddf38dc8fc031b823c0" title="Local Frames per packet.">nLocalFramePerPacket</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a921c890c8d1f7ae8b8cc0cabf27bf778" title="Frame per packet of local (Tx) voice codec.">nLocalFramePerPacket</a>; </div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a84"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a808b6d14a237e0980af27c8ad71f96b4" title="Remote Frames per packet.">nRemoteFramePerPacket</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a5ec2b162f986c6016bf17dddd98c93d3" title="Frame per packet of remote (Rx) voice codec.">nRemoteFramePerPacket</a>; </div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a85"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a697f620ecd9dcbaaa79eed81bda295e0" title="Frames per packet for VBD.">nFramePerPacket_vbd</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a0760774c59b4302c41a13c3f20ee971e" title="Frame per packet of voice codec (vbd)">nFramePerPacket_vbd</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a86"></a><a class="code" href="structTstVoipMgrRtpCfg.html#aba4a3369332569eb293521a049af96a5" title="VAD is on or off.">bVAD</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#aba143d7f2f2e9130cc729056b3668e66" title="Enable/Disable VAD (Voice activity detection)  Valid values are: 0: Disable 1: Enable.">bVAD</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a87"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a3c52656b55aa1b79a5702755b31d1ba3" title="PLC is on or off.">bPLC</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#ae31dc1e199838d927b4ff751e4dc4d5a" title="Enable/Disable PLC (Packet Loss Concealment)  Valid values are: 0: Disable 1: Enable.">bPLC</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a88"></a><a class="code" href="structTstVoipMgrRtpCfg.html#ae92df6923ff0ae4ed36bbe1e328be72c" title="Jitter buffer delay.">nJitterDelay</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a5edd303e38c49d0870ae64c0682b0bd1" title="minimun jitter delay (10ms)  nJitterDelay is the minimum delay of jitter buffer.  Valid values are 4 ...">nJitterDelay</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a89"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a1fef99f06fdba4904b1d6a7344335f9f" title="Maximum jitter buffer delay.">nMaxDelay</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a1cf71efa5a26840869adc9ce70812506" title="maximum jitter delay (10ms)  nJitterDelay is the maximum delay of jitter buffer.  Valid values are 13...">nMaxDelay</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a90"></a><a class="code" href="structTstVoipMgrRtpCfg.html#ae3cb4df68fa85f75645b8d29659a8873" title="Maximum strict jitter buffer delay (10ms)">nMaxStrictDelay</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a2994da36a394d9edf2ff126817181e48" title="maximum strict jitter delay (10ms)  nMaxStrictDelay is the maximum strict delay of jitter buffer...">nMaxStrictDelay</a>;</div>
<div class="line">                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].<a name="a91"></a><a class="code" href="structTstVoipMgrRtpCfg.html#a84636303cfecd02711e37888f4f85d73" title="fitter buffer factor">nJitterFactor</a> = codec_config[chid][i].<a class="code" href="structpayloadtype__config__t.html#a2435652e35b35df20454edaeca7942d0" title="optimzation factor of jitter buffer  The optimization factor is the value for adjusting the quality o...">nJitterFactor</a>;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_RTK_VOIP_IPV6_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>                        stVoipMgr3WayCfg.<a class="code" href="structTstVoipMgr3WayCfg.html#a0d9ddcdce5c0fa2fa1a6549485dca5c7" title="onference these two sessions">rtp_cfg</a>[i].ipv6 = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                    }</div>
<div class="line">                    <a class="code" href="group__TAPI__MEDIA__RTP.html#gac63c0aa5b5f1f68d6cef7bb0cea2a96a" title="Enable/Disable conference.">rtk_SetConference</a>(&amp;stVoipMgr3WayCfg);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (session_state[chid][!ssid] == STATE_RTP) </div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// stop dial tone in current session</span></div>
<div class="line">                    <a class="code" href="group__TAPI__DSP__TONE.html#gabdf79ea0528aebf4451782bafb5a0f01" title="Play/Stop the assigned tone.">rtk_SetPlayTone</a>(chid, ssid, <a class="code" href="voip__params_8h.html#a110631afe96ae06621f3894e1014f1dda34743a7930889088b12bc64517dc48ff" title="code = 76 in RFC2833, index = 37">DSPCODEC_TONE_HOLD</a>, 0, <a class="code" href="voip__params_8h.html#ab8ba0e766b9b42fab7e432d9370a6859a603db07fd09627f84ca635385b914182" title="local">DSPCODEC_TONEDIRECTION_LOCAL</a>);</div>
<div class="line">                    <span class="comment">// change to old session </span></div>
<div class="line">                    ssid = !ssid;</div>
<div class="line">                    ActiveSession[chid] = ssid;</div>
<div class="line">                    <a class="code" href="group__TAPI__MEDIA__MISC.html#gaed19a0479f028247263e839f224c7f56" title="Assign the active session.">rtk_SetTranSessionID</a>(chid, ssid);</div>
<div class="line">                    <span class="comment">// resume old session</span></div>
<div class="line">                    <a class="code" href="group__TAPI__MEDIA__RTP.html#gaaa753726d4ee3eb96c1cd2183a812248" title="Hold/Resume RTP.">rtk_HoldRtp</a>(chid, ssid, 0);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// do nothing if no rtp session exist</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        usleep(100000 / CON_CH_NUM); <span class="comment">// 100ms</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">goto</span> main_loop;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 3 2014 11:37:43 for VoIP Interface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
